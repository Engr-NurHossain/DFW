@model HS.Entities.CreateTicketModel
@using HS.Framework
@using AppConfig = HS.Framework.Utils.AppConfig;
@using LabelHelper = HS.Web.UI.Helper.LabelHelper
@using Localize = HS.Web.UI.Helper.LanguageHelper
@using TickType = HS.Web.UI.Helper.LabelHelper.TicketType
@using DateTimeExt = HS.Framework.DateTimeExtension
@using TickStat = HS.Web.UI.Helper.LabelHelper.TicketStatus
@using PermissionChekcer = HS.Web.UI.Helper.PermissionHelper
@using Permissions = HS.Framework.UserPermissions
@{
    Layout = null;
    string Address = HS.Web.UI.Helper.AddressHelper.MakeAddress(Model.Customer);
    string PickupAddress = HS.Web.UI.Helper.AddressHelper.MakeAddressForPickUporDropof(Model.PickupAddress);
    string DropofAddress = HS.Web.UI.Helper.AddressHelper.MakeAddressForPickUporDropof(Model.DropofAddress);
    string BillingAddress = HS.Web.UI.Helper.AddressHelper.MakeAddressForPickUporDropof(Model.ServiceAddress);
    string Currency = HS.Web.UI.Helper.LabelHelper.CurrentTransMakeCurrency.MakeCurrency();

    bool ShowCost = PermissionChekcer.IsPermitted(Permissions.CustomerPermissions.CustomerTicketShowCost); //need to be show retail price
    bool ShowRetailPrice = PermissionChekcer.IsPermitted(Permissions.CustomerPermissions.CustomerTicketShowRetailPrice);
    bool ShowDescriptionPermit = PermissionChekcer.IsPermitted(Permissions.CustomerPermissions.CustomerTicketShowDescription);
    bool ShowPointPermit = PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.CustomerTicketShowPoint);
    bool ShowTicketEquipmentReleaseButton = PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.TicketEquipmentReleaseButton);
    bool ShowInstallPermit = PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.CustomerTicketShowInstall);
    bool EditReleasedEquipmentUnitPrice = PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.EditReleasedEquipmentUnitPrice);
    bool ShowTicketEquipmentCost = PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.ShowTicketEquipmentCost);
    bool ShowTicketEquipmentUndoButton = PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.TicketEquipmentUndoButton);

    var count = 0;
    var count1 = 0;
    var CurrentUser = (HS.Web.UI.Helper.CustomPrincipal)User;
    var SystemUserSelect = false;
    //if (Model.Ticket.Status == LabelHelper.TicketStatus.Init)
    //{
    //    SystemUserSelect = true;
    //}
    if (Model.TicketAssignedUserList.Count(y => y.UserId == new Guid("22222222-2222-2222-2222-222222222222")) > 0)
    {
        SystemUserSelect = true;
    }
    bool AfterCompleteTicketItemAdd = ViewBag.AfterCompleteTicketItemAdd;
}

@Styles.Render("~/styles/ServiceOrderProductInstallation")
<script src="~/Content/Tiny/jquery.tinymce.min.js"></script>
<script src="~/Content/Tiny/tinymce.min.js"></script>
<script src="~/Content/Select2/Select2.min.js"></script>
<script src="~/Content/momentJs/moment.min.js"></script>
@Scripts.Render("~/scripts/AddTicKetJSAll")

@Styles.Render("~/styles/AddTicKetCS")
<style>

    .scheduleoncontainer {
        display: flex !important;
    }

    .pika-table td.is-disabled {
        background-color: #eb8b8b;
        cursor: not-allowed;
        border-radius: 7px;
    }

        .pika-table td.is-disabled button {
            color: black !important;
            text-align: center;
            text-decoration: none;
        }
</style>

<script>
    var rowcount = 1;
    var AttachVal = "Invoice";
    var UserFileUploadjqXHRData;
    var FileDescription;
    var TinyMCEHeightSet = 250;
    var TicketStatus = '@Model.Ticket.Status';
    var AfterCompleteTicketItemAdd = '@AfterCompleteTicketItemAdd';
    var IsClosed='@Model.Ticket.IsClosed';
    var IsClosedPermission = '@PermissionChekcer.IsPermitted(Permissions.CustomerPermissions.CloseTicketPermission)';
    var WorkToBePerformedPermit = '@PermissionChekcer.IsPermitted(Permissions.MyCompanyPermissions.AddWorkToBePerformedAddendum)';
    var TicketType = '@Model.Ticket.TicketType';
    var TicketId = '@Model.Ticket.TicketId';
    var TicketIntId = @Model.Ticket.Id;
    var IsComplete = false;
    var HoursToAdd = @Model.TicketDefaultTimeDuration;
    var HasInvoice = '@Model.Ticket.HasInvoice';
    var GuidCustomer = '@Model.Customer.CustomerId';
    var TicketCustomerIntId = '@Model.Customer.Id';
    var ScheduleTicketStatus = '@ViewBag.TempTicketStatusval';
    var UserRole = '@ViewBag.UserRole';
    var isticketpay = '@Model.Ticket.IsTicketPayment';
    var isClockIn = '@ViewBag.IsClockedIn';
    var Minute = '@ViewBag.Minute';
    var Second = '@ViewBag.Second';
    var Hour = '@ViewBag.Hour';
    var Currency = '@Currency';
    var DestinationCusAddress = '@Address';

    var ShowCost='@ShowCost';
    var ShowRetailPrice='@ShowRetailPrice';
    var ShowDescriptionPermit = '@ShowDescriptionPermit';
    var ShowPointPermit = '@ShowPointPermit';
    var ShowInstallPermit = '@ShowInstallPermit';
    var ShowTicketEquipmentReleaseButton = '@ShowTicketEquipmentReleaseButton';
    var BookingId = '@Model.Ticket.BookingId';
    var ShowTicketEquipmentCost = '@ShowTicketEquipmentCost';
    var ClockInOutType = "";
    var signature = '@PermissionChekcer.IsPermitted(Permissions.CustomerPermissions.TicketSignature)';
    var ticketsignature = '@Model.Ticket.Signature';
    var LogActive = '@(!Model.ShowNoteFirst)';

    var pos = {
        lat: 0,
        lng: 0
    };
    var EquipmentTypes = {
        Service :    '@LabelHelper.EquipmentType.Service' ,
        Equipment :  '@LabelHelper.EquipmentType.Equipment'
    }
    var strTicket = '@Localize.T("Ticket")';
    var TicketFieldsPermission = '@PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.TicketFieldsHideDisablePermission)';
</script>

@Scripts.Render("~/scripts/AddTicKetJS")





@*<script src="~/Content/Js/ServiceOrderProductInstallation/AddProductServiceOrder.js"></script>*@
<div class="hidden" style="display:none;visibility:hidden;height:0px;">
    <input type="hidden" id="ticket_customerId" value="@Model.Customer.CustomerId" />
    <input type="hidden" id="Ticket_Id" value="@Model.Ticket.Id" />
    <input type="hidden" id="Ticket_TicketId" value="@Model.Ticket.TicketId" />
    <input type="hidden" id="UploadedPath" value="" />
    <input type="file" name="CustomerFile" class="" id="UploadedFile" />
    <textarea class="hidden" id="BodyVal">@Model.Ticket.Message</textarea>
</div>

@{
    var CustomerName = "";
    if (Model.Customer.BusinessName != null)
    {


        CustomerName = Model.Customer.FirstName + " " + Model.Customer.LastName;
        if (!string.IsNullOrWhiteSpace(Model.Customer.DBA))
        {
            CustomerName = Model.Customer.DBA;
        }
        else if (Model.Customer.Type == "Commercial" && !string.IsNullOrWhiteSpace(Model.Customer.BusinessName))
        {
            CustomerName = Model.Customer.BusinessName;
        }
        <div class="header-title">
            @{
                if (Model.Ticket.ReferenceTicketId > 0)
                {
                    <div class="ticket-details">
                        <span class="custom-title-span add_ticket_title_device">@Html.Raw((Model.Ticket.Status == TickStat.Init ? string.Format("Create {0} for: <a class='name-anchor-style-for-ticker' href='{3}/Customer/Customerdetail/?id={2}' target='_blank' >{1}</a>", Localize.T("Ticket"), CustomerName, @Model.Customer.Id, (AppConfig.DomainSitePath)) : String.Format("{5} #{0} (ReferId #{2}) for: <a class='name-anchor-style-for-ticker' href='{4}/Customer/Customerdetail/?id={3}' target='_blank'> {1} </a>", Model.Ticket.Id, CustomerName, Model.Ticket.ReferenceTicketList, Model.Customer.Id, (AppConfig.DomainSitePath), Localize.T("Ticket")))) </span>

                    </div>
                }
                else
                {
                    <div class="ticket-details">
                        <span class="custom-title-span add_ticket_title_device">@Html.Raw((Model.Ticket.Status == TickStat.Init ? string.Format("Create {0} for: <a class='name-anchor-style-for-ticker' href='{3}/Customer/Customerdetail/?id={2}' target='_blank'>{1} </a>", Localize.T("Ticket"), CustomerName, Model.Customer.Id, (AppConfig.DomainSitePath)) : String.Format("{4} #{0} for: <a class='name-anchor-style-for-ticker' href='{3}/Customer/Customerdetail/?id={2}' target='_blank'> {1} </a>", Model.Ticket.Id, CustomerName, Model.Customer.Id, (AppConfig.DomainSitePath), Localize.T("Ticket"))))   </span>
                    </div>
                }
            }

            @if (Model.Ticket.IsAgreementTicket == true && !string.IsNullOrEmpty(Model.SoldBy))
            {
                <div class="salesperson-details">
                    <span class="custom-title-span add_ticket_title_device">Sold By : @Model.SoldBy</span>
                </div>
            }
            <div onclick="CloseTopToBottomTicket()" class="ticketCloseDiv">
                <img class="close_btn_size" title="@Localize.T("Close")" src="~/Content/Icons/cross_update.png">
            </div>
        </div>
    }
    else
    {
        <div class="header-title add_ticket_title_device">
            <div class="ticket-details">
                <span class="custom-title-span add_ticket_title_device">Create @Localize.T("Ticket") for:</span>
                <span class="custom-title-span-dynamic add_ticket_title_device"></span>
            </div>
            @if (Model.Ticket.IsAgreementTicket == true && !string.IsNullOrEmpty(Model.SoldBy))
            {
                <div class="salesperson-details">
                    <span class="custom-title-span add_ticket_title_device">Sold By : @Model.SoldBy</span>
                </div>
            }
            <div onclick="CloseTopToBottomTicket()" class="ticketCloseDiv">
                <img class="close_btn_size" title="@Localize.T("Close")" src="~/Content/Icons/cross_update.png">
            </div>
        </div>
    }
}
<div>
    <div class="ticket-loader-div">
        <div class="ticketLoaderFade"></div>
        <div class='invoice-loader'><div><div class='lds-css ng-scope'><div style='margin:auto; z-index:99;' class='lds-double-ring'><div></div><div></div></div></div></div></div>
    </div>

    <div class="col-md-12 add_ticket_main">
        <div class="add_ticket_contetns">
            <div class="ticket_body col-md-8">
                <div class="Customerdetail_addresss_for_ticket">
                    @if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.EditAndShowDiffrentTicketAddress))
                    {
                        if (Model.Ticket.TicketType == "Pick Up")
                        {
                            <a><i class="fa fa-pencil-square-o OpenEditPickUpLocationModel" aria-hidden="true"></i></a>
                        }
                        else if (Model.Ticket.TicketType == "Drop Off")
                        {
                            <a><i class="fa fa-pencil-square-o OpenEditDropOffLocationModel" aria-hidden="true"></i></a>
                        }
                        else if (Model.Ticket.TicketType == "Service")
                        {
                            <a><i class="fa fa-pencil-square-o OpenEditBillingAddressModel" title="Edit" @*onclick="OpenEditAddresModel('BillingAddress')"*@ aria-hidden="true"></i></a>
                        }

                        if (!string.IsNullOrWhiteSpace(Model.Customer.Street) || (!string.IsNullOrWhiteSpace(Model.Customer.City) && !string.IsNullOrWhiteSpace(Model.Customer.State) && !string.IsNullOrWhiteSpace(Model.Customer.ZipCode)))
                        {
                            <img class="addressMapPopup green-tooltip" data-id="@Model.Customer.CustomerId" src="~/Content/img/location.png" data-toggle="tooltip" title="View Map" style="cursor:pointer" />
                            if (Model.Ticket.TicketType == "Pick Up")
                            {
                                <span class="customeraddress_style_ticket">@PickupAddress</span>
                            }
                            else if (Model.Ticket.TicketType == "Drop Off")
                            {
                                <span class="customeraddress_style_ticket">@DropofAddress</span>
                            }
                            else if (Model.Ticket.TicketType == "Service")
                            {
                                if (!string.IsNullOrEmpty(BillingAddress))
                                {
                                    <span class="customeraddress_style_ticket">@BillingAddress</span>
                                }
                                else
                                {
                                    <span class="customeraddress_style_ticket">@Address</span>
                                }

                            }
                            else
                            {
                                <span class="customeraddress_style_ticket">@Address</span>
                            }

                        }
                    }
                    else
                    {
                        if (!string.IsNullOrWhiteSpace(Model.Customer.Street) || (!string.IsNullOrWhiteSpace(Model.Customer.City) && !string.IsNullOrWhiteSpace(Model.Customer.State) && !string.IsNullOrWhiteSpace(Model.Customer.ZipCode)))
                        {
                            <img class="addressMapPopup green-tooltip" data-id="@Model.Customer.CustomerId" src="~/Content/img/location.png" data-toggle="tooltip" title="View Map" style="cursor:pointer" />
                            <span class="customeraddress_style_ticket">@Address</span>
                        }
                    }

                    @if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.ShowMapDirection) && (!string.IsNullOrWhiteSpace(Model.Customer.Street) || (!string.IsNullOrWhiteSpace(Model.Customer.City) && !string.IsNullOrWhiteSpace(Model.Customer.State) && !string.IsNullOrWhiteSpace(Model.Customer.ZipCode))))
                    {
                        <a href="javascript:void(0)" onclick="GetDirection()" id="getDirection" title="Get Direction">
                            <img src="~/Content/Icons/direction.png" />
                            @*<svg x="0px" y="0px" width="20" height="20" viewBox="0 0 172 172">
                                    <g fill="none" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><path d="M0,172v-172h172v172z" fill="none"></path><g><path d="M2.65391,86c0,-46.02344 37.32266,-83.34609 83.34609,-83.34609c46.02344,0 83.34609,37.32266 83.34609,83.34609c0,46.02344 -37.32266,83.34609 -83.34609,83.34609c-46.02344,0 -83.34609,-37.32266 -83.34609,-83.34609z" fill="#3498db"></path><path d="M34.66875,82.47266l47.43437,-29.12578c1.31016,-0.80625 2.98984,-0.83984 4.33359,-0.10078c1.34375,0.73906 2.18359,2.18359 2.18359,3.72891v58.01641c0,1.54531 -0.83984,2.95625 -2.18359,3.72891c-0.63828,0.36953 -1.37734,0.5375 -2.08281,0.5375c-0.77266,0 -1.54531,-0.20156 -2.21719,-0.63828l-47.43437,-28.89062c-1.27656,-0.77266 -2.04922,-2.15 -2.04922,-3.62813c-0.03359,-1.47812 0.73906,-2.85547 2.01563,-3.62812z" fill="#ffffff"></path><path d="M56.60547,77.09766h78.71016c2.25078,0 4.03125,1.81406 4.03125,4.03125v9.70859c0,2.25078 -1.81406,4.03125 -4.03125,4.03125h-78.71016c-2.25078,0 -4.03125,-1.81406 -4.03125,-4.03125v-9.70859c-0.03359,-2.21719 1.78047,-4.03125 4.03125,-4.03125z" fill="#ffffff"></path></g></g>
                                </svg>*@
                        </a>
                    }

                    @if (!string.IsNullOrWhiteSpace(Model.Customer.CustomerNo))
                    {
                        <i class="fa fa-eye green-tooltip" aria-hidden="true" data-toggle="tooltip" title="Central Station Account Number"></i> <span>@Model.Customer.CustomerNo</span>
                    }
                    @if (!string.IsNullOrWhiteSpace(Model.Customer.EmailAddress))
                    {
                        <i class="fa fa-envelope green-tooltip" aria-hidden="true" data-toggle="tooltip" title="@Model.Customer.EmailAddress" style="cursor:pointer" onclick="OpenCorrespondenceTab()"></i>
                    }
                    @if (!string.IsNullOrWhiteSpace(Model.Customer.PrimaryPhone))
                    {
                        <i class="fa fa-phone green-tooltip" aria-hidden="true" data-toggle="tooltip" title="@Model.Customer.PrimaryPhone" style="cursor:pointer" onclick="OpenCorrespondenceTab()"></i>
                    }
                    else if (!string.IsNullOrWhiteSpace(Model.Customer.SecondaryPhone))
                    {
                        <i class="fa fa-phone green-tooltip" aria-hidden="true" data-toggle="tooltip" title="@Model.Customer.SecondaryPhone" style="cursor:pointer" onclick="OpenCorrespondenceTab()"></i>
                    }
                    else if (!string.IsNullOrWhiteSpace(Model.Customer.CellNo))
                    {
                        <i class="fa fa-phone green-tooltip" aria-hidden="true" data-toggle="tooltip" title="@Model.Customer.CellNo" style="cursor:pointer" onclick="OpenCorrespondenceTab()"></i>
                    }

                </div>
                <table class="ticketTable addticketbottomtable">
                    @if (Model.Ticket.Status != TickStat.Init)
                    {
                        //if (PermissionChekcer.IsPermitted(Permissions.CustomerPermissions.CloseTicketPermission))
                        //{
                        <tr>
                            <td colspan="2" class="ticket_button_style ticket_attach_btn_style">
                                @if (PermissionChekcer.IsPermitted(Permissions.CustomerPermissions.ShowTicketBackwardButton))
                                {
                                    <button class="btn" id="back_ticket_load" onclick="OpenTicketById('@Model.Ticket.Id')"><i class="fa fa-backward"></i></button>
                                }
                                @if (PermissionChekcer.IsPermitted(Permissions.CustomerPermissions.TicketShowEstimate))
                                {
                                    <button id="AttachEstimate" class="btn">@Localize.T("Attach Estimate")</button>
                                }
                                @if (PermissionChekcer.IsPermitted(Permissions.CustomerPermissions.ShowTicketAttachInvoice))
                                {
                                    <button id="AttachInvoice" class="btn">@Localize.T("Attach Invoice")</button>
                                }
                                @if (PermissionChekcer.IsPermitted(Permissions.CustomerPermissions.ShowTicketAttachFile))
                                {
                                    <button id="AttachFile" class="btn">@Localize.T("Attach File")</button>
                                }
                                @if (PermissionChekcer.IsPermitted(Permissions.CustomerPermissions.TicketShowEquipment))
                                {
                                    <button id="AttachProducts" class="btn">@Localize.T("Attach Products")</button>
                                }
                                @if (PermissionChekcer.IsPermitted(Permissions.CustomerPermissions.ShowTicketAttachService))
                                {
                                    <button id="AttachServices" class="btn">@Localize.T("Attach Services")</button>
                                }
                            </td>
                        </tr>
                        @*}
                            else
                            {
                                if (Model.Ticket.IsClosed != true)
                                {
                                    <tr>
                                        <td colspan="2" class="ticket_button_style ticket_attach_btn_style">
                                            <button class="btn" id="back_ticket_load" onclick="OpenTicketById('@Model.Ticket.Id')"><i class="fa fa-backward"></i></button>
                                            <button id="AttachEstimate" class="btn">@Localize.T("Attach Estimate")</button>
                                            <button id="AttachInvoice" class="btn">@Localize.T("Attach Invoice")</button>
                                            <button id="AttachFile" class="btn">@Localize.T("Attach File")</button>
                                            @if (PermissionChekcer.IsPermitted(Permissions.CustomerPermissions.TicketShowEquipment))
                                            {
                                                <button id="AttachProducts" class="btn">@Localize.T("Attach Products")</button>
                                            }
                                            @if (PermissionChekcer.IsPermitted(Permissions.CustomerPermissions.ShowTicketAttachService))
                                            {
                                                <button id="AttachServices" class="btn">@Localize.T("Attach Services")</button>
                                            }
                                        </td>
                                    </tr>
                                }
                            }*@
                        if (Model.Ticket.IsAgreementTicket == true && Model.PackageCustomermodel != null)
                        {
                            <tr>
                                <td colspan="2">
                                    <div>
                                        <b>@Localize.T("Package")</b><span>: @Model.PackageCustomermodel.PackageName</span>
                                    </div>
                                    <div>
                                        @Html.DropDownListFor(x => x.PackageCustomermodel.PackageId, ViewBag.PackageList as List<SelectListItem>, new { @class = "form-control hidden" })
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="2">
                                    <div class="package-additional-features">

                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <button id="ConfirmPackageChange" class="btn hidden">Confirm Package Change</button>
                                </td>
                            </tr>
                        }
                        <tr class="attach_invoice hidden">
                            <td class="text-right">
                                <b class="atach_inv_text">@Localize.T("Attach Invoice")</b>
                            </td>
                            <td>
                                @Html.DropDownList("InvoiceList", ViewBag.InvoiceList as List<SelectListItem>, new { @class = "form-control" })
                            </td>
                        </tr>
                        <tr class="attach_invoice hidden">
                            <td></td>
                            <td class="text-right">
                                <button class="btn AttachInvoiceEstimatebtn">@Localize.T("Attach")</button>
                            </td>
                        </tr>

                        <tr class="attach_estimate hidden">
                            <td class="text-right">
                                <b class="atach_inv_text">@Localize.T("Attach Estimate")</b>
                            </td>
                            <td>
                                @Html.DropDownList("EstimateList", ViewBag.EstimateList as List<SelectListItem>, new { @class = "form-control" })

                            </td>
                        </tr>
                        <tr class="attach_estimate hidden">
                            <td></td>
                            <td class="text-right">
                                <button class="btn AttachInvoiceEstimatebtn">@Localize.T("Attach")</button>
                            </td>
                        </tr>
                        <tr class="addfile_tr hidden">
                            <td valign="top" colspan="2">
                                <b>@Localize.T("Add File")</b>

                                <table class="w100p">
                                    <tr>
                                        <td>
                                            <textarea type="text" class="form-control FileDescription" placeholder="File Description" id="FileDescription" name="FileDescription" rows="3"></textarea>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="text-right">
                                            <button id="UploadCustomerFileBtn" class="btn cursor-pointer">
                                                @Localize.T("Choose File")
                                            </button>
                                            <button id="AddFileBtn" class="btn cursor-pointer">
                                                @Localize.T("Upload")
                                            </button>
                                            <div class="" style="margin-top: 15px;">
                                                <span id="UploadSuccessMessage" class="hidden">@Localize.T("File Uploaded Successfully..!")</span>
                                            </div>
                                        </td>
                                    </tr>
                                    @*<tr>
                                            <td>
                                                <label id="SelectedFileName"></label>
                                                <div class="col-md-12 progress-container file-progress" style="display:none; padding-left:0; padding-right:0; margin-top: 15px;">
                                                    <div class="progress progress-striped active">
                                                        <div class="progress-bar progress-bar-success" style="width:0%">
                                                            <span> 0%</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>*@
                                    <tr>
                                        <td></td>
                                    </tr>
                                </table>
                            </td>
                        </tr>

                        if (PermissionChekcer.IsPermitted(Permissions.CustomerPermissions.TicketShowEquipment))
                        {
                            <tr class="Add_equipment @((Model.CustomerAppointmentEquipmentList==null||Model.CustomerAppointmentEquipmentList.Count()==0)?"hidden":"")">
                                <td colspan="2">
                                    <div class="col-md-12 Add_equipment">
                                        <div>
                                            <div class="EquipmentAdd clearfix">
                                                <div class="row">
                                                    <div class="col-md-12 padding-0 add_ticket_product_table">
                                                        @if (PermissionChekcer.IsPermitted(Permissions.CustomerPermissions.CustomerTicketEquipmentSoldBy))
                                                        {
                                                            <div class="width-100p soldBySelectDiv">
                                                                @Html.DropDownList("Equipment_SoldBy", ViewBag.EmpListCopy as List<SelectListItem>, new { @class = "form-control" })
                                                                <span>Change Equipment Sold-By</span>
                                                            </div>
                                                        }
                                                        <table class="CustomerInvoiceTab ticket_add_product_table tble_lay_fixed" id="CustomerInvoiceTab">
                                                            <thead>
                                                                <tr class="InvoiceTableBorderTop">
                                                                    <th class="hidden"></th>
                                                                    <th class="hidden"></th>
                                                                    <th class="hidden"></th>
                                                                    <th class="hidden"></th>
                                                                    <th class="hidden"></th>
                                                                    <th class="thead-th-style1 prod_title">
                                                                        <span title="Assign user">

                                                                        </span>
                                                                    </th>
                                                                    <th class="hidden"></th>
                                                                    @if (ShowTicketEquipmentReleaseButton)
                                                                    {
                                                                        <th class="thead-th-style1 prod_release"  style="display:none">
                                                                            <span>
                                                                                @Localize.T("Release")
                                                                            </span>
                                                                        </th>
                                                                    }
                                                                    <th class="thead-th-style1 prod_equip">
                                                                        <span>
                                                                            @Localize.T("Equipment")
                                                                        </span>
                                                                    </th>
                                                                    <th class="thead-th-style1 prod_equip">
                                                                        <span>
                                                                            @Localize.T("SKU")
                                                                        </span>
                                                                    </th>
                                                                    @if (ShowDescriptionPermit)
                                                                    {
                                                                        <th class="thead-th-style2 prod_desc">
                                                                            <span>
                                                                                @Localize.T("Description")
                                                                            </span>
                                                                        </th>
                                                                    }
                                                                    @if (ShowPointPermit)
                                                                    {
                                                                        <th class="thead-th-style2 prod_onhand">
                                                                            <span>
                                                                                @Localize.T("Point")
                                                                            </span>
                                                                        </th>
                                                                    }
                                                                    <th class="thead-th-style2 prod_onhand">
                                                                        <span>
                                                                            @Localize.T("On Hand")
                                                                        </span>
                                                                    </th>
                                                                    @if (ShowInstallPermit)
                                                                    {
                                                                        <th class="thead-th-style2 prod_qtyleft">
                                                                            <span>
                                                                                @Localize.T("Installed")
                                                                            </span>
                                                                        </th>
                                                                    }
                                                                    <th class="thead-th-style2 prod_qty">
                                                                        <span>
                                                                            @Localize.T("Qty")
                                                                        </span>
                                                                    </th>
                                                                    @if (ShowTicketEquipmentCost)
                                                                    {
                                                                        <th class="thead-th-style2 prod_qty">
                                                                            <span>
                                                                                @Localize.T("Unit Cost")
                                                                            </span>
                                                                        </th>
                                                                    }

                                                                    <th class="thead-th-style2 prod_unit @(ShowCost?"":"hidden")">
                                                                        <span>
                                                                            @Localize.T("Unit_")
                                                                        </span>
                                                                    </th>
                                                                    <th class="thead-th-style2 prod_price @(ShowRetailPrice? "" : "hidden")">
                                                                        <span>
                                                                            @Localize.T("Price")
                                                                        </span>
                                                                    </th>
                                                                    <th class="thead-th-style2 prod_action">

                                                                    </th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                @if (Model.CustomerAppointmentEquipmentList != null)
                                                                {
                                                                    foreach (var item in Model.CustomerAppointmentEquipmentList)
                                                                    {
                                                                        string CreatedBy = "";
                                                                        if (!string.IsNullOrWhiteSpace(item.CreatedBy))
                                                                        {
                                                                            CreatedBy = "Added By: " + item.CreatedBy;
                                                                        }
                                                                        if (!string.IsNullOrWhiteSpace(item.SKU))
                                                                        {
                                                                            if (CreatedBy != "")
                                                                            {
                                                                                CreatedBy += ", ";
                                                                            }
                                                                            CreatedBy += "SKU: " + item.SKU;
                                                                        }

                                                                        if (item.IsEquipmentRelease == true)
                                                                        {
                                                                            <tr data-int-id="@item.Id" class="HasItem" data-id="@item.EquipmentId" data-release="@item.IsEquipmentRelease">
                                                                                <td class="hidden spnIsEquipmentRelease">@item.IsEquipmentRelease</td>
                                                                                <td class="hidden spnIsInvoiceCreate">@item.IsInvoiceCreate</td>
                                                                                <td class="hidden spnReferenceInvoiceId">@item.ReferenceInvoiceId</td>
                                                                                <td class="hidden spnReferenceInvoiceDetailId">@item.ReferenceInvDetailId</td>
                                                                                <td class="hidden spnIsBilling">@item.IsBilling</td>
                                                                                <td valign="top" class="badinventory_move_@count" data-id="@item.EquipmentId" data-name="@item.EquipName" data-cusid="@Model.Ticket.CustomerId" data-qty="@item.Quantity" data-ticketid="@Model.Ticket.TicketId" data-dohand="@item.QuantityOnHand" data-doqty="@item.Quantity" data-dodetail="@item.EquipDetail" data-tikintid="@Model.Ticket.Id">
                                                                                    <i class="fa fa-cogs" onclick="OpenBadInventoryAndUserAssignPopup('@item.AppointmentId', '@item.Id', '@Model.Ticket.CustomerId', @count, @item.QuantityOnHand)"></i>
                                                                                    @if (ShowTicketEquipmentUndoButton)
                                                                                    {
                                                                                        <i class="fa fa-undo" title="Undo" onclick="UndoThisEquipment('@item.AppointmentId',@item.Id)"></i>
                                                                                    }
                                                                                </td>
                                                                                <td class="hidden spnIsBillingProcess">@item.IsBillingProcess</td>
                                                                                @if (ShowTicketEquipmentReleaseButton)
                                                                                {
                                                                                    <td valign="top" style="display:none">
                                                                                        @{
                                                                                            if (item.IsCheckedEquipment == true)
                                                                                            {
                                                                                                <input type="checkbox" checked disabled style="display:block !important" class="chkQuantityValid" />
                                                                                            }
                                                                                            else
                                                                                            {
                                                                                                <input type="checkbox" disabled style="display:block !important" class="chkQuantityValid" />
                                                                                            }
                                                                                        }
                                                                                    </td>
                                                                                }
                                                                                <td valign="top">
                                                                                    <input type="text" class="ProductName hidden" value="@item.EquipName" onkeydown="SearchKeyDown(this,event)" onkeyup="SearchKeyUp(this,event)" />
                                                                                    <p title="@CreatedBy" class="spnProductName" @(item.IsEquipmentExist == true ? "Style=color:#e400ff" : "")> @item.EquipName</p>
                                                                                </td>
                                                                                @if (ShowDescriptionPermit)
                                                                                {
                                                                                    <td valign="top">
                                                                                        <input type="text" onkeydown='OthersKeyDown(this,event)' value="@item.EquipDetail" class="txtProductDesc hidden" />
                                                                                        <p class="spnProductDesc">@item.EquipDetail</p>
                                                                                    </td>
                                                                                }
                                                                                <td valign="top">
                                                                                    <p class="spnProductDesc spnSku">@item.SKU</p>
                                                                                </td>
                                                                                @if (ShowPointPermit)
                                                                                {
                                                                                    <td valign="top">
                                                                                        <p data-point="@item.Point" class="spnProductPoint">@LabelHelper.FormatAmount(item.TotalPoint)</p>
                                                                                    </td>
                                                                                }
                                                                                @if (item.QuantityOnHand.ToString().IndexOf("-") > -1)
                                                                                {
                                                                                    <td valign="top" class="">
                                                                                        <p class="spnProductQuantityOnHand"
                                                                                           data-new-added="0"
                                                                                           data-is-equipexist="@(item.IsEquipmentExist == true ? 1 : 0)"
                                                                                           data-onHand="0">
                                                                                            0
                                                                                        </p>
                                                                                    </td>
                                                                                }
                                                                                else
                                                                                {
                                                                                    <td valign="top" class="">
                                                                                        <p class="spnProductQuantityOnHand"
                                                                                           data-new-added="0"
                                                                                           data-is-equipexist="@(item.IsEquipmentExist == true ? 1 : 0)"
                                                                                           data-onHand="@(item.QuantityOnHand < 0 ? 0 : item.QuantityOnHand)">
                                                                                            @(item.QuantityOnHand < 0 ? 0 : item.QuantityOnHand)
                                                                                        </p>
                                                                                    </td>

                                                                                }
                                                                                @if (ShowInstallPermit)
                                                                                {
                                                                                    if (item.QuantityLeftEquipment < 0)
                                                                                    {
                                                                                        <td valign="top">
                                                                                            <input type="number" onkeydown='OthersKeyDown(this, event)' value="@item.QuantityLeftEquipment" class="txtProductQuantityLeft hidden" />
                                                                                            <span class="spnProductQuantityLeft" style="display:block !important" data-qtyLeft="@item.QuantityLeftEquipment">@item.QuantityLeftEquipment</span>
                                                                                        </td>
                                                                                    }
                                                                                    else
                                                                                    {
                                                                                        <td valign="top">
                                                                                            <input type="number" onkeydown='OthersKeyDown(this, event)' value="@item.QuantityLeftEquipment" class="txtProductQuantityLeft" />
                                                                                            <span class="spnProductQuantityLeft" data-qtyLeft="@item.QuantityLeftEquipment">@item.QuantityLeftEquipment</span>
                                                                                        </td>
                                                                                    }
                                                                                }
                                                                                <td valign="top">
                                                                                    <input type="number" onkeydown='OthersKeyDown(this, event)' value="@item.Quantity" class="txtProductQuantity hidden" />
                                                                                    <p class="spnProductQuantity" data-unitprice="@item.UnitPrice">@item.Quantity</p>
                                                                                </td>

                                                                                @*<td valign="top" class="@(ShowCost?"":"hidden")">
            <input type="number" onkeydown='OthersKeyDown(this, event)' value="@item.Equipmentvendorcost" class="txtProductEquipmentvendorcost hidden" />
            <span class="spnProductEquipmentvendorcost" style="display:block !important">@Currency@LabelHelper.FormatAmount(item.Equipmentvendorcost)</span>
        </td>*@
                                                                                @if (ShowTicketEquipmentCost)
                                                                                {
                                                                                    <td valign="top" class="">
                                                                                        <p class="spnProductEquipmentvendorcost">@Currency@LabelHelper.FormatAmount(item.Equipmentvendorcost)</p>
                                                                                    </td>
                                                                                }
                                                                                <td valign="top" class="@(ShowCost?"":"hidden")">
                                                                                    @if (EditReleasedEquipmentUnitPrice)
                                                                                    {
                                                                                        <input type="number" onkeydown='OthersKeyDown(this, event)' value="@(Math.Round(item.UnitPrice,2))" class="txtProductUnitPrice" />
                                                                                        <span class="spnProductRate">@Currency@LabelHelper.FormatAmount(item.UnitPrice)</span>
                                                                                    }
                                                                                    else
                                                                                    {
                                                                                        <input type="number" onkeydown='OthersKeyDown(this, event)' value="@(Math.Round(item.UnitPrice,2))" class="txtProductUnitPrice hidden" />
                                                                                        <span class="spnProductRate" style="display:block !important">@Currency@LabelHelper.FormatAmount(item.UnitPrice)</span>
                                                                                    }
                                                                                </td>
                                                                                <td valign="top" class="@(ShowRetailPrice?"":"hidden")">
                                                                                    <input type="number" onkeydown='OthersKeyDown(this, event)' value="@(Math.Round(item.TotalPrice,2))" class="txtProductAmount hidden" />
                                                                                    <span class="spnProductAmount" style="display:block !important">@Currency@LabelHelper.FormatAmount(item.TotalPrice)</span>
                                                                                </td>
                                                                                <td valign="top" class="tableActions"></td>
                                                                            </tr>
                                                                        }
                                                                        else
                                                                        {
                                                            <tr data-int-id="@item.Id" data-id="@item.EquipmentId" data-unitprice="@item.UnitPrice" data-totalprice="@item.TotalPrice" data-equipvendorcost="@item.Equipmentvendorcost" class="HasItem">
                                                                <td class="hidden spnIsEquipmentRelease">@item.IsEquipmentRelease</td>
                                                                <td class="hidden spnIsInvoiceCreate">@item.IsInvoiceCreate</td>
                                                                <td class="hidden spnReferenceInvoiceId">@item.ReferenceInvoiceId</td>
                                                                <td class="hidden spnReferenceInvoiceDetailId">@item.ReferenceInvDetailId</td>
                                                                <td class="hidden spnIsBilling">@item.IsBilling</td>
                                                                <td valign="top" class="badinventory_move_@count" data-id="@item.EquipmentId" data-name="@item.EquipName" data-cusid="@Model.Ticket.CustomerId" data-qty="@item.Quantity" data-ticketid="@Model.Ticket.TicketId" data-dohand="@item.QuantityOnHand" data-doqty="@item.Quantity" data-dodetail="@item.EquipDetail" data-tikintid="@Model.Ticket.Id">
                                                                    <i class="fa fa-cogs" onclick="OpenBadInventoryAndUserAssignPopup('@item.AppointmentId', '@item.Id', '@Model.Ticket.CustomerId', @count, @item.QuantityOnHand)"></i>
                                                                    @if (ShowTicketEquipmentUndoButton && item.QuantityLeftEquipment > 0)
                                                                    {
                                                                        <i class="fa fa-undo" title="Undo" onclick="UndoThisEquipment('@item.AppointmentId',@item.Id)"></i>
                                                                    }
                                                                </td>
                                                                <td class="hidden spnIsBillingProcess">@item.IsBillingProcess</td>
                                                                @if (ShowTicketEquipmentReleaseButton)
                                                                {
                                                                    <td valign="top" style="display:none">
                                                                        @{
                                                                            if (item.QuantityOnHand > 0)
                                                                            {
                                                                                if (item.IsCheckedEquipment == true)
                                                                                {
                                                                                    <input type="checkbox" checked style="display:block !important" class="chkQuantityValid" />
                                                                                }
                                                                                else
                                                                                {
                                                                                    <input type="checkbox" style="display:block !important" class="chkQuantityValid" />
                                                                                }
                                                                            }
                                                                        }
                                                                    </td>
                                                                }
                                                                <td valign="top" class="tick_product_name">
                                                                    <input type="text" class="ProductName" value="@item.EquipName" onkeydown="SearchKeyDown(this,event)" onkeyup="SearchKeyUp(this,event)" />
                                                                    <div class='tt-menu'><div class='tt-dataset tt-dataset-autocomplete'> </div> </div>
                                                                    <span title="@CreatedBy" class="spnProductName" @(item.IsEquipmentExist == true ? "Style=color:#e400ff" : "")>@item.EquipName</span>
                                                                </td>
                                                                @if (ShowDescriptionPermit)
                                                                {
                                                                    <td valign="top">
                                                                        <input type="text" onkeydown='OthersKeyDown(this,event)' value="@item.EquipDetail" class="txtProductDesc" />
                                                                        <span class="spnProductDesc">@item.EquipDetail</span>
                                                                    </td>
                                                                }
                                                                <td valign="top">
                                                                    <p class="spnProductDesc spnSku" data-sku="@item.SKU">@item.SKU</p>
                                                                </td>
                                                                @if (ShowPointPermit)
                                                                {
                                                                    <td valign="top">
                                                                        <p data-point="@item.Point" class="spnProductPoint">@LabelHelper.FormatAmount(item.TotalPoint)</p>
                                                                    </td>
                                                                }
                                                                @*@if (item.QuantityOnHand.ToString().IndexOf("-") > -1)
        {
            <td valign="top" class="@(item.QuantityOnHand<item.Quantity?"qtyhandwarning":"")">
                <p class="spnProductQuantityOnHand" data-new-added="0" data-is-equipexist="@(item.IsEquipmentExist == true ? 1 : 0)" data-onHand="0">0</p>
            </td>
        }
        else
        {*@
                                                                <td valign="top" class="@(item.QuantityOnHand < item.Quantity ? "qtyhandwarning" : "")">
                                                                    <p class="spnProductQuantityOnHand"
                                                                       data-new-added="0"
                                                                       data-is-equipexist="@(item.IsEquipmentExist == true ? 1 : 0)"
                                                                       data-onHand="@(item.QuantityOnHand < 0 ? 0 : item.QuantityOnHand)">
                                                                        @(item.QuantityOnHand < 0 ? 0 : item.QuantityOnHand)
                                                                    </p>
                                                                </td>
                                                                @*}*@
                                                                @if (ShowInstallPermit)
                                                                {
                                                                    if (item.QuantityLeftEquipment < 0)
                                                                    {
                                                                        <td valign="top">
                                                                            <input type="number" onkeydown='OthersKeyDown(this, event)' value="@item.QuantityLeftEquipment" class="txtProductQuantityLeft" />
                                                                            <span class="spnProductQuantityLeft" data-qtyLeft="@item.QuantityLeftEquipment">@item.QuantityLeftEquipment</span>
                                                                        </td>
                                                                    }
                                                                    else
                                                                    {
                                                                        <td valign="top">
                                                                            <input type="number" onkeydown='OthersKeyDown(this, event)' value="@item.QuantityLeftEquipment" class="txtProductQuantityLeft" />
                                                                            <span class="spnProductQuantityLeft" data-qtyLeft="@item.QuantityLeftEquipment">@item.QuantityLeftEquipment</span>
                                                                        </td>
                                                                    }
                                                                }
                                                                <td valign="top">
                                                                    <input type="number" onkeydown='OthersKeyDown(this, event)' value="@item.Quantity" class="txtProductQuantity" />
                                                                    <span class="spnProductQuantity" data-unitprice="@item.UnitPrice">@item.Quantity</span>
                                                                </td>

                                                                @*<td valign="top" class="@(ShowCost?"":"hidden")">
            <input type="number" onkeydown='OthersKeyDown(this, event)' value="@item.Equipmentvendorcost" class="txtProductEquipmentvendorcost" />
            <span class="spnProductEquipmentvendorcost">@Currency@LabelHelper.FormatAmount(item.Equipmentvendorcost)</span>
        </td>*@
                                                                @if (ShowTicketEquipmentCost)
                                                                {
                                                                    <td valign="top" class="@(item.Equipmentvendorcost)">
                                                                        <p class="spnProductEquipmentvendorcost">@Currency@LabelHelper.FormatAmount(item.Equipmentvendorcost)</p>
                                                                    </td>
                                                                }
                                                                <td valign="top" class="@(ShowCost?"":"hidden")">
                                                                    <input type="number" onkeydown='OthersKeyDown(this, event)' value="@(Math.Round(item.UnitPrice,2))" class="txtProductUnitPrice" />
                                                                    <span class="spnProductRate">@Currency@LabelHelper.FormatAmount(item.UnitPrice)</span>
                                                                </td>
                                                                <td valign="top" class="@(ShowRetailPrice?"":"hidden")">
                                                                    <input type="number" onkeydown='OthersKeyDown(this, event)' value="@(Math.Round(item.TotalPrice,2))" class="txtProductAmount" />
                                                                    <span class="spnProductAmount">@Currency@LabelHelper.FormatAmount(item.TotalPrice)</span>
                                                                </td>
                                                                <td valign="top" class="tableActions">
                                                                    @if (item.QuantityLeftEquipment == 0)
                                                                    {
                                                                        <i class="fa fa-trash-o trash-hidden" aria-hidden="true" data-id="@item.Id" title="@Localize.T("Delete")"></i>
                                                                    }
                                                                </td>
                                                            </tr>
                                                                        }
                                                                        count = count + 1;
                                                                    }
                                                                    if (!Model.CustomerAppointment.Status.HasValue || Model.CustomerAppointment.Status == false)
                                                                    {
                                                                        if (AfterCompleteTicketItemAdd == true || Model.Ticket.Status != "Completed")
                                                                        {
                                                                            <tr class="validate-row">
                                                                                <td class="hidden spnIsEquipmentRelease">false</td>
                                                                                <td class="hidden spnIsInvoiceCreate">false</td>
                                                                                <td class="hidden spnReferenceInvoiceId"></td>
                                                                                <td class="hidden spnReferenceInvoiceDetailId"></td>
                                                                                <td class="hidden spnIsBilling">false</td>
                                                                                <td valign="top"></td>
                                                                                <td class="hidden spnIsBillingProcess">false</td>
                                                                                @if (ShowTicketEquipmentReleaseButton)
                                                                                {
                                                                                    <td valign="top" style="display:none">
                                                                                        <input type="checkbox" class="chkQuantityValid" />
                                                                                    </td>
                                                                                }
                                                                                <td valign="top" class="tick_product_name">
                                                                                    <input type="text" class="ProductName" onkeydown="SearchKeyDown(this,event)" onkeyup="SearchKeyUp(this,event)" />
                                                                                    <div class='tt-menu'><div class='tt-dataset tt-dataset-autocomplete'> </div> </div>
                                                                                    <span class="spnProductName"></span>
                                                                                </td>
                                                                                @if (ShowDescriptionPermit)
                                                                                {
                                                                                    <td valign="top">
                                                                                        <input type="text" onkeydown='OthersKeyDown(this,event)' class="txtProductDesc" />
                                                                                        <span class="spnProductDesc"></span>
                                                                                    </td>
                                                                                }
                                                                                <td valign="top">
                                                                                    <p class="spnProductDesc spnSku"></p>
                                                                                </td>
                                                                                @if (ShowPointPermit)
                                                                                {
                                                                                    <td valign="top">
                                                                                        <p class="spnProductPoint"></p>
                                                                                    </td>
                                                                                }
                                                                                <td valign="top">
                                                                                    <p class="spnProductQuantityOnHand"></p>
                                                                                </td>
                                                                                @if (ShowInstallPermit)
                                                                                {
                                                                                    <td valign="top">
                                                                                        <input type="number" onkeydown='OthersKeyDown(this, event)' class="txtProductQuantityLeft" />
                                                                                        <span class="spnProductQuantityLeft"></span>
                                                                                    </td>
                                                                                }
                                                                                <td valign="top">
                                                                                    <input type="number" onkeydown='OthersKeyDown(this, event)' class="txtProductQuantity" />
                                                                                    <span class="spnProductQuantity" data-unitprice=""></span>
                                                                                </td>

                                                                                @*<td valign="top" class="@(ShowCost?"":"hidden")">
                            <input type="number" onkeydown='OthersKeyDown(this, event)' class="txtProductEquipmentvendorcost" />
                            <span class="spnProductEquipmentvendorcost"></span>
                        </td>*@
                                                                                @if (ShowTicketEquipmentCost)
                                                                                {
                                                                                    <td valign="top">
                                                                                        <p class="spnProductEquipmentvendorcost"></p>
                                                                                    </td>
                                                                                }
                                                                                <td valign="top" class="@(ShowCost ? "" : "hidden")">
                                                                                    <input type="number" onkeydown='OthersKeyDown(this, event)' class="txtProductUnitPrice" />
                                                                                    <span class="spnProductRate"></span>
                                                                                </td>
                                                                                <td valign="top" class="@(ShowRetailPrice ? "" : "hidden")">
                                                                                    <input type="number" onkeydown='OthersKeyDown(this, event)' class="txtProductAmount" />
                                                                                    <span class="spnProductAmount"></span>
                                                                                </td>
                                                                                <td valign="top" class="tableActions">
                                                                                    <i class="fa fa-trash-o trash-hidden" aria-hidden="true" title="@Localize.T("Delete")"></i>
                                                                                </td>
                                                                            </tr>
                                                                            if (Model.CustomerAppointmentEquipmentList.Count() == 0)
                                                                            {
                                                                                <tr>
                                                                                    <td class="hidden spnIsEquipmentRelease">false</td>
                                                                                    <td class="hidden spnIsInvoiceCreate">false</td>
                                                                                    <td class="hidden spnReferenceInvoiceId"></td>
                                                                                    <td class="hidden spnReferenceInvoiceDetailId"></td>
                                                                                    <td class="hidden spnIsBilling">false</td>
                                                                                    <td valign="top"></td>
                                                                                    <td class="hidden spnIsBillingProcess">false</td>
                                                                                    @if (ShowTicketEquipmentReleaseButton)
                                                                                    {
                                                                                        <td valign="top" style="display:none">
                                                                                            <input type="checkbox" class="chkQuantityValid" />
                                                                                        </td>
                                                                                    }
                                                                                    <td valign="top" class="tick_product_name">
                                                                                        <input type="text" class="ProductName" onkeydown="SearchKeyDown(this,event)" onkeyup="SearchKeyUp(this,event)" />
                                                                                        <div class='tt-menu'><div class='tt-dataset tt-dataset-autocomplete'> </div> </div>
                                                                                        <span class="spnProductName"></span>
                                                                                    </td>
                                                                                    @if (ShowDescriptionPermit)
                                                                                    {
                                                                                        <td valign="top">
                                                                                            <input type="text" onkeydown='OthersKeyDown(this,event)' class="txtProductDesc" />
                                                                                            <span class="spnProductDesc"></span>
                                                                                        </td>
                                                                                    }
                                                                                    <td valign="top">
                                                                                        <p class="spnProductDesc spnSku"></p>
                                                                                    </td>
                                                                                    @if (ShowPointPermit)
                                                                                    {
                                                                                        <td valign="top">
                                                                                            <p class="spnProductPoint"></p>
                                                                                        </td>
                                                                                    }
                                                                                    <td valign="top">
                                                                                        <p class="spnProductQuantityOnHand"></p>
                                                                                    </td>
                                                                                    @if (ShowInstallPermit)
                                                                                    {
                                                                                        <td valign="top">
                                                                                            <input type="number" onkeydown='OthersKeyDown(this, event)' class="txtProductQuantityLeft" />
                                                                                            <span class="spnProductQuantityLeft"></span>
                                                                                        </td>
                                                                                    }
                                                                                    <td valign="top">
                                                                                        <input type="number" onkeydown='OthersKeyDown(this, event)' class="txtProductQuantity" />
                                                                                        <span class="spnProductQuantity" data-unitprice=""></span>
                                                                                    </td>
                                                                                    @if (ShowTicketEquipmentCost)
                                                                                    {
                                                                                        <td valign="top">
                                                                                            <p class="spnProductEquipmentvendorcost"></p>
                                                                                        </td>
                                                                                    }
                                                                                    @*<td valign="top" class="@(ShowCost?"":"hidden")">
                                <input type="number" onkeydown='OthersKeyDown(this, event)' class="txtProductEquipmentvendorcost" />
                                <span class="spnProductEquipmentvendorcost"></span>
                            </td>*@
                                                                                    <td valign="top" class="@(ShowCost ? "" : "hidden")">
                                                                                        <input type="number" onkeydown='OthersKeyDown(this, event)' class="txtProductUnitPrice" />
                                                                                        <span class="spnProductRate"></span>
                                                                                    </td>
                                                                                    <td valign="top" class="@(ShowRetailPrice ? "" : "hidden")">
                                                                                        <input type="number" onkeydown='OthersKeyDown(this, event)' class="txtProductAmount" />
                                                                                        <span class="spnProductAmount"></span>
                                                                                    </td>
                                                                                    <td valign="top" class="tableActions">
                                                                                        <i class="fa fa-trash-o trash-hidden" aria-hidden="true" title="@Localize.T("Delete")"></i>
                                                                                    </td>
                                                                                </tr>
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                                else
                                                                {
                                                                    if (AfterCompleteTicketItemAdd == true || Model.Ticket.Status != "Completed")
                                                                    {
                                                                        <tr>
                                                                            <td class="hidden spnIsEquipmentRelease">false</td>
                                                                            <td class="hidden spnIsInvoiceCreate">false</td>
                                                                            <td class="hidden spnReferenceInvoiceId"></td>
                                                                            <td class="hidden spnReferenceInvoiceDetailId"></td>
                                                                            <td class="hidden spnIsBilling">false</td>
                                                                            <td valign="top"></td>
                                                                            <td class="hidden spnIsBillingProcess">false</td>
                                                                            @if (ShowTicketEquipmentReleaseButton)
                                                                            {
                                                                                <td valign="top" style="display:none">
                                                                                    <input type="checkbox" class="chkQuantityValid" />
                                                                                </td>
                                                                            }
                                                                            <td valign="top" class="tick_product_name">
                                                                                <input type="text" class="ProductName" onkeydown="SearchKeyDown(this,event)" onkeyup="SearchKeyUp(this,event)" />
                                                                                <div class='tt-menu'><div class='tt-dataset tt-dataset-autocomplete'> </div> </div>
                                                                                <span class="spnProductName"></span>
                                                                            </td>
                                                                            @if (ShowDescriptionPermit)
                                                                            {
                                                                                <td valign="top">
                                                                                    <input type="text" onkeydown='OthersKeyDown(this,event)' class="txtProductDesc" />
                                                                                    <span class="spnProductDesc"></span>
                                                                                </td>
                                                                            }
                                                                            <td valign="top">
                                                                                <p class="spnProductDesc spnSku"></p>
                                                                            </td>
                                                                            @if (ShowPointPermit)
                                                                            {
                                                                                <td valign="top">
                                                                                    <p class="spnProductPoint"></p>
                                                                                </td>
                                                                            }
                                                                            <td valign="top">
                                                                                <p class="spnProductQuantityOnHand"></p>
                                                                            </td>
                                                                            @if (ShowInstallPermit)
                                                                            {
                                                                                <td valign="top">
                                                                                    <input type="number" onkeydown='OthersKeyDown(this, event)' class="txtProductQuantityLeft" />
                                                                                    <span class="spnProductQuantityLeft"></span>
                                                                                </td>
                                                                            }
                                                                            <td valign="top">
                                                                                <input type="number" onkeydown='OthersKeyDown(this, event)' class="txtProductQuantity" />
                                                                                <span class="spnProductQuantity" data-unitprice=""></span>
                                                                            </td>
                                                                            @if (ShowTicketEquipmentCost)
                                                                            {
                                                                                <td valign="top">
                                                                                    <p class="spnProductEquipmentvendorcost"></p>
                                                                                </td>
                                                                            }
                                                                            @*<td valign="top" class="@(ShowCost?"":"hidden")">
                        <input type="number" onkeydown='OthersKeyDown(this, event)' class="txtProductEquipmentvendorcost" />
                        <span class="spnProductEquipmentvendorcost"></span>
                    </td>*@
                                                                            <td valign="top" class="@(ShowCost ? "" : "hidden")">
                                                                                <input type="number" onkeydown='OthersKeyDown(this, event)' class="txtProductUnitPrice" />
                                                                                <span class="spnProductRate"></span>
                                                                            </td>
                                                                            <td valign="top" class="@(ShowRetailPrice ? "" : "hidden")">
                                                                                <input type="number" onkeydown='OthersKeyDown(this, event)' class="txtProductAmount" />
                                                                                <span class="spnProductAmount"></span>
                                                                            </td>
                                                                            <td valign="top" class="tableActions">
                                                                                <i class="fa fa-trash-o trash-hidden" aria-hidden="true" title="@Localize.T("Delete")"></i>
                                                                            </td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td class="hidden spnIsEquipmentRelease">false</td>
                                                                            <td class="hidden spnIsInvoiceCreate">false</td>
                                                                            <td class="hidden spnReferenceInvoiceId"></td>
                                                                            <td class="hidden spnReferenceInvoiceDetailId"></td>
                                                                            <td class="hidden spnIsBilling">false</td>
                                                                            <td valign="top"></td>
                                                                            <td class="hidden spnIsBillingProcess"></td>
                                                                            @if (ShowTicketEquipmentReleaseButton)
                                                                            {
                                                                                <td valign="top" style="display:none">
                                                                                    <input type="checkbox" class="chkQuantityValid" />
                                                                                </td>
                                                                            }
                                                                            <td valign="top" class="tick_product_name">
                                                                                <input type="text" class="ProductName" onkeydown="SearchKeyDown(this,event)" onkeyup="SearchKeyUp(this,event)" />
                                                                                <div class='tt-menu'><div class='tt-dataset tt-dataset-autocomplete'> </div> </div>
                                                                                <span class="spnProductName"></span>
                                                                            </td>
                                                                            @if (ShowDescriptionPermit)
                                                                            {
                                                                                <td valign="top">
                                                                                    <input type="text" onkeydown='OthersKeyDown(this,event)' class="txtProductDesc" />
                                                                                    <span class="spnProductDesc"></span>
                                                                                </td>
                                                                            }
                                                                            <td valign="top">
                                                                                <p class="spnProductDesc spnSku"></p>
                                                                            </td>
                                                                            @if (ShowPointPermit)
                                                                            {
                                                                                <td valign="top">
                                                                                    <p class="spnProductPoint"></p>
                                                                                </td>
                                                                            }
                                                                            <td valign="top">
                                                                                <p class="spnProductQuantityOnHand"></p>
                                                                            </td>
                                                                            @if (ShowInstallPermit)
                                                                            {
                                                                                <td valign="top">
                                                                                    <input type="number" onkeydown='OthersKeyDown(this, event)' class="txtProductQuantityLeft" />
                                                                                    <span class="spnProductQuantityLeft"></span>
                                                                                </td>
                                                                            }
                                                                            <td valign="top">
                                                                                <input type="number" onkeydown='OthersKeyDown(this, event)' class="txtProductQuantity" />
                                                                                <span class="spnProductQuantity" data-unitprice=""></span>
                                                                            </td>
                                                                            @if (ShowTicketEquipmentCost)
                                                                            {
                                                                                <td valign="top">
                                                                                    <p class="spnProductEquipmentvendorcost"></p>
                                                                                </td>
                                                                            }
                                                                            @*<td valign="top" class="@(ShowCost?"":"hidden")">
                        <input type="number" onkeydown='OthersKeyDown(this, event)' class="txtProductEquipmentvendorcost" />
                        <span class="spnProductEquipmentvendorcost"></span>
                    </td>*@
                                                                            <td valign="top" class="@(ShowCost ? "" : "hidden")">
                                                                                <input type="number" onkeydown='OthersKeyDown(this, event)' class="txtProductUnitPrice" />
                                                                                <span class="spnProductRate"></span>
                                                                            </td>
                                                                            <td valign="top" class="@(ShowRetailPrice ? "" : "hidden")">
                                                                                <input type="number" onkeydown='OthersKeyDown(this, event)' class="txtProductAmount" />
                                                                                <span class="spnProductAmount"></span>
                                                                            </td>
                                                                            <td valign="top" class="tableActions">
                                                                                <i class="fa fa-trash-o trash-hidden" aria-hidden="true" title="@Localize.T("Delete")"></i>
                                                                            </td>
                                                                        </tr>
                                                                    }
                                                                }
                                                            </tbody>
                                                        </table>
                                                        <table border="1" class="total-eqpservice">
                                                            <tbody>
                                                                @if (ShowTicketEquipmentCost)
                                                                {
                                                                    <tr>
                                                                        <td>
                                                                            <span>@Localize.T("Total Equipment Cost")</span>
                                                                        </td>
                                                                        <td>
                                                                            @if (Model.CustomerAppointmentEquipmentList != null)
                                                                            {
                                                                                <span id="spnTotalVendorCost">@Currency@LabelHelper.FormatAmount(Model.CustomerAppointmentEquipmentList.Sum(m => m.Equipmentvendorcost * m.Quantity))</span>
                                                                            }
                                                                            else
                                                                            {
                                                                                <span id="spnTotalVendorCost">@Currency@LabelHelper.FormatAmount(0)</span>
                                                                            }
                                                                        </td>
                                                                    </tr>
                                                                }
                                                                @if (ShowRetailPrice)
                                                                {
                                                                    <tr>
                                                                        <td>
                                                                            <span>@Localize.T("Total Retail Price")</span>
                                                                        </td>
                                                                        <td>
                                                                            @if (Model.CustomerAppointmentEquipmentList != null)
                                                                            {
                                                                                <span id="spnTotalPrice">@Currency@LabelHelper.FormatAmount(Model.CustomerAppointmentEquipmentList.Sum(m => m.TotalPrice))</span>
                                                                            }
                                                                            else
                                                                            {
                                                                                <span id="spnTotalPrice">@Currency@LabelHelper.FormatAmount(0)</span>
                                                                            }
                                                                        </td>
                                                                    </tr>
                                                                }
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                                <div class="InvoiceCalculationsDiv InvoiceCalculationsDiv1 hidden">
                                                    <div class="WorkOrderTaxCalculation">
                                                        <div class="clearfix"><div class="text_bold">@Localize.T("Subtotal"):</div> <div class="text_normal amount">@HS.Web.UI.Helper.LabelHelper.CurrentTransMakeCurrency.MakeCurrency(null)</div></div>
                                                        <div class="clearfix"><div class="text_bold"><div class="tax_dropdown">@Html.DropDownListFor(x => x.CustomerAppointment.TaxPercent, (List<SelectListItem>)ViewBag.TaxListItem, new { @class = "form-control select_TaxList" })</div></div><div class="text_normal tax-amount">@HS.Web.UI.Helper.LabelHelper.CurrentTransMakeCurrency.MakeCurrency(null)</div></div>
                                                        <div class="clearfix"><div class="text_bold">@Localize.T("Total"):</div> <div class="text_normal total total_text_norm">@HS.Web.UI.Helper.LabelHelper.CurrentTransMakeCurrency.MakeCurrency(null)</div></div>

                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="ticket_create_update_btn">
                                            @if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.CustomerTicketCreateDo))
                                            {
                                                <button id="CreateDOTicket" class="btn cursor-pointer">
                                                    @Localize.T("Create DO")
                                                </button>
                                            }
                                            @if (ViewBag.UpdateEqpServiceBtn == true)
                                            {
                                                <button id="UpdateEqList" class="btn cursor-pointer">
                                                    @Localize.T("Update Equipment List")@*@(Model.Ticket.TicketType == TickType.Installtion ? Localize.T("Work Order") : Localize.T("Service Order"))*@
                                                </button>
                                            }
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        }
                        if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.TicketAttachMISC))
                        {
                            <tr class="attach_misc Add_equipment">
                                <td colspan="2">
                                    <div class="holder_left">
                                        <label>@Localize.T("MISC Name")</label>
                                        <input class="form-control" type="text" id="MiscName" name="MiscName" value="@Model.Ticket.MiscName" />
                                    </div>

                                    <div class="holder_right currency_style">
                                        <label>@Localize.T("MISC Value")</label>
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text">
                                                    $
                                                </span>
                                            </div>
                                            <input class="form-control" type="text" id="MiscValue" name="MiscValue" value="@Model.Ticket.MiscValue" />
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        }
                        <tr class="LoadReferenceTicketList"></tr>
                        if (PermissionChekcer.IsPermitted(Permissions.CustomerPermissions.ShowTicketAttachService))
                        {
                            <tr class="Add_service @((Model.CustomerAppointmentServiceList==null||Model.CustomerAppointmentServiceList.Count()==0)?"hidden":"")">
                                <td colspan="2">
                                    <div class="col-md-12 Add_service">
                                        <div>
                                            <div class="EquipmentAdd clearfix">
                                                <div class="row">
                                                    <div class="col-md-12 padding-0 add_ticket_product_table">
                                                        @if (PermissionChekcer.IsPermitted(Permissions.CustomerPermissions.CustomerTicketServiceSoldBy))
                                                        {
                                                            <div class="width-100p soldBySelectDiv">
                                                                @Html.DropDownList("Service_SoldBy", ViewBag.EmpListCopy as List<SelectListItem>, new { @class = "form-control" })
                                                                <span>Change Service Sold-By</span>
                                                            </div>
                                                        }

                                                        <table class="CustomerInvoiceTab ticket_add_product_table" id="CustomerServiceTable">
                                                            <thead>
                                                                <tr class="InvoiceTableBorderTop">
                                                                    <th class="hidden"></th>
                                                                    <th class="hidden"></th>
                                                                    <th class="hidden"></th>
                                                                    <th class="hidden"></th>
                                                                    <th class="hidden"></th>
                                                                    <th class="thead-th-style1 prod_title">
                                                                        <span>

                                                                        </span>
                                                                    </th>
                                                                    <th class="hidden"></th>
                                                                    <th class="thead-th-style1 tab-Product">
                                                                        <span>
                                                                            @Localize.T("Service")
                                                                        </span>
                                                                    </th>
                                                                    @if (ShowDescriptionPermit)
                                                                    {
                                                                        <th class="thead-th-style2 tab-Desc">
                                                                            <span>
                                                                                @Localize.T("Description")
                                                                            </span>
                                                                        </th>
                                                                    }
                                                                    <th class="thead-th-style2 tab-Quantity">
                                                                        <span>
                                                                            @Localize.T("Qty")
                                                                        </span>
                                                                    </th>
                                                                    <th class="thead-th-style2 tab-Rate @(ShowCost?"":"hidden")">
                                                                        <span>
                                                                            @Localize.T("Unit")
                                                                        </span>
                                                                    </th>
                                                                    <th class="thead-th-style2 tab-Amount @(ShowRetailPrice?"":"hidden")">
                                                                        <span>
                                                                            @Localize.T("Price")
                                                                        </span>
                                                                    </th>
                                                                    <th class="thead-th-style2 tab-Action">

                                                                    </th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                @if (Model.CustomerAppointmentServiceList != null)
                                                                {
                                                                    foreach (var item in Model.CustomerAppointmentServiceList)
                                                                    {
                                                                        string CreatedBy = "";
                                                                        if (!string.IsNullOrWhiteSpace(item.CreatedBy))
                                                                        {
                                                                            CreatedBy = "Added By: " + item.CreatedBy;
                                                                        }
                                                                        if (!string.IsNullOrWhiteSpace(item.SKU))
                                                                        {
                                                                            if (CreatedBy != "")
                                                                            {
                                                                                CreatedBy += ", ";
                                                                            }
                                                                            CreatedBy += "SKU: " + item.SKU;
                                                                        }
                                                                        if (item.IsEquipmentRelease == true)
                                                                        {
                                                                <tr class="IsService" data-int-id="@item.Id">
                                                                    <td class="hidden spnIsInvoiceCreate">@item.IsInvoiceCreate</td>
                                                                    <td class="hidden spnReferenceInvoiceId">@item.ReferenceInvoiceId</td>
                                                                    <td class="hidden spnReferenceInvoiceDetailId">@item.ReferenceInvDetailId</td>
                                                                    <td class="hidden spnIsBilling">@item.IsBilling</td>
                                                                    <td class="hidden spnIsCopied">@item.IsCopied</td>
                                                                    <td valign="top"></td>
                                                                    <td class="hidden spnIsBillingProcess">@item.IsBillingProcess</td>
                                                                    <td valign="top">
                                                                        <p title="@CreatedBy" class="spnProductName">@item.EquipName</p>
                                                                    </td>

                                                                    @if (ShowDescriptionPermit)
                                                                    {
                                                                        <td valign="top">
                                                                            <p class="spnProductDesc">@item.EquipDetail</p>
                                                                        </td>
                                                                    }
                                                                    <td valign="top">
                                                                        <p class="spnProductDesc spnSku">@item.SKU</p>
                                                                    </td>
                                                                    <td valign="top">
                                                                        <p class="spnProductQuantity" data-unitprice="">@item.Quantity</p>
                                                                    </td>
                                                                    <td valign="top" class="@(ShowCost ? "" : "hidden")">
                                                                        <span class="spnProductRate">@Currency@LabelHelper.FormatAmount(item.UnitPrice)</span>
                                                                    </td>
                                                                    <td valign="top" class="@(ShowRetailPrice ? "" : "hidden")">
                                                                        @*<p class="spnProductAmount">@Currency@LabelHelper.FormatAmount(item.TotalPrice)</p>*@
                                                                        <input type="number" onkeydown='OthersKeyDown(this, event)' value="@(Math.Round(item.TotalPrice,2))" class="txtProductAmount" />
                                                                        <span class="spnProductAmount">@Currency@LabelHelper.FormatAmount(item.TotalPrice)</span>
                                                                    </td>
                                                                    <td valign="top" class="tableActions"></td>
                                                                </tr>
                                                                        }
                                                                        else
                                                                        {
                                                            <tr data-int-id="@item.Id" data-id="@item.EquipmentId" data-unitprice="@item.UnitPrice" data-totalprice="@item.TotalPrice" data-equipvendorcost="@item.Equipmentvendorcost" class="HasItem IsService">
                                                                <td class="hidden spnIsInvoiceCreate">@item.IsInvoiceCreate</td>
                                                                <td class="hidden spnReferenceInvoiceId">@item.ReferenceInvoiceId</td>
                                                                <td class="hidden spnReferenceInvoiceDetailId">@item.ReferenceInvDetailId</td>
                                                                <td class="hidden spnIsBilling">@item.IsBilling</td>
                                                                <td class="hidden spnIsCopied">@item.IsCopied</td>
                                                                <td valign="top">
                                                                    <i class="fa fa-cogs" onclick="OpenBadInventoryAndUserAssignPopup('@item.AppointmentId', '@item.Id', '@Model.Ticket.CustomerId', 0, 0)"></i>
                                                                </td>
                                                                <td class="hidden spnIsBillingProcess">@item.IsBillingProcess</td>
                                                                @{
                                                                    if (item.IsBilling == true)
                                                                    {
                                                                        <td valign="top" class="tick_product_name">
                                                                            <input type="text" class="ProductName" value="@item.EquipName" onkeydown="SearchKeyDown(this,event)" onkeyup="SearchKeyUp(this,event,'Service')" />
                                                                            <div class='tt-menu'><div class='tt-dataset tt-dataset-autocomplete'> </div> </div>
                                                                            <span title="@CreatedBy" class="spnProductName" style="color:#2ca01c;">@item.EquipName</span>
                                                                        </td>
                                                                    }
                                                                    else
                                                                    {
                                                                        <td valign="top" class="tick_product_name">
                                                                            <input type="text" class="ProductName" value="@item.EquipName" onkeydown="SearchKeyDown(this,event)" onkeyup="SearchKeyUp(this,event,'Service')" />
                                                                            <div class='tt-menu'><div class='tt-dataset tt-dataset-autocomplete'> </div> </div>
                                                                            <span title="@CreatedBy" class="spnProductName">@item.EquipName</span>
                                                                        </td>
                                                                    }

                                                                }


                                                                @if (ShowDescriptionPermit)
                                                                {
                                                                    <td valign="top">
                                                                        <input type="text" onkeydown='OthersKeyDown(this,event)' value="@item.EquipDetail" class="txtProductDesc" />
                                                                        <span class="spnProductDesc">@item.EquipDetail</span>
                                                                    </td>
                                                                }
                                                                <td valign="top">
                                                                    <p class="spnProductDesc spnSku">@item.SKU</p>
                                                                </td>
                                                                <td valign="top">
                                                                    <input type="number" onkeydown='OthersKeyDown(this, event)' value="@item.Quantity" class="txtProductQuantity" />
                                                                    <span class="spnProductQuantity" data-unitprice="@item.UnitPrice">@item.Quantity</span>
                                                                </td>
                                                                <td valign="top" class="@(ShowCost?"":"hidden")">
                                                                    <input type="number" onkeydown='OthersKeyDown(this, event)' value="@(Math.Round(item.UnitPrice,2))" class="txtProductUnitPrice" />
                                                                    <span class="spnProductRate">@Currency@LabelHelper.FormatAmount(item.UnitPrice)</span>
                                                                </td>
                                                                <td valign="top" class="@(ShowRetailPrice?"":"hidden")">
                                                                    <input type="number" onkeydown='OthersKeyDown(this, event)' value="@(Math.Round(item.TotalPrice,2))" class="txtProductAmount" />
                                                                    <span class="spnProductAmount">@Currency@LabelHelper.FormatAmount(item.TotalPrice)</span>
                                                                </td>
                                                                <td valign="top" class="tableActions">

                                                                    <i class="fa fa-trash-o trash-hidden" aria-hidden="true" data-id="@item.Id" title="@Localize.T("Delete")"></i>
                                                                </td>
                                                            </tr>
                                                                        }
                                                                        count1 = count1 + 1;
                                                                    }
                                                                    if (!Model.CustomerAppointment.Status.HasValue || Model.CustomerAppointment.Status == false)
                                                                    {
                                                                        if (AfterCompleteTicketItemAdd == true || Model.Ticket.Status != "Completed")
                                                                        {
                                                            <tr class="IsService">
                                                                <td class="hidden spnIsInvoiceCreate">false</td>
                                                                <td class="hidden spnReferenceInvoiceId"></td>
                                                                <td class="hidden spnReferenceInvoiceDetailId"></td>
                                                                <td class="hidden spnIsBilling">false</td>
                                                                <td class="hidden spnIsCopied">false</td>
                                                                <td valign="top"></td>
                                                                <td class="hidden spnIsBillingProcess">false</td>
                                                                <td valign="top" class="tick_product_name">
                                                                    <input type="text" class="ProductName" onkeydown="SearchKeyDown(this,event)" onkeyup="SearchKeyUp(this,event,'Service')" />
                                                                    <div class='tt-menu'><div class='tt-dataset tt-dataset-autocomplete'> </div> </div>
                                                                    <span class="spnProductName"></span>
                                                                </td>
                                                                @if (ShowDescriptionPermit)
                                                                {
                                                                    <td valign="top">
                                                                        <input type="text" onkeydown='OthersKeyDown(this,event)' class="txtProductDesc" />
                                                                        <span class="spnProductDesc"></span>
                                                                    </td>
                                                                }
                                                                <td valign="top">
                                                                    <p class="spnProductDesc spnSku"></p>
                                                                </td>
                                                                <td valign="top">
                                                                    <input type="number" onkeydown='OthersKeyDown(this, event)' class="txtProductQuantity" />
                                                                    <span class="spnProductQuantity" data-unitprice=""></span>
                                                                </td>
                                                                <td valign="top" class="@(ShowCost?"":"hidden")">
                                                                    <input type="number" onkeydown='OthersKeyDown(this, event)' class="txtProductUnitPrice" />
                                                                    <span class="spnProductRate"></span>
                                                                </td>
                                                                <td valign="top" class="@(ShowRetailPrice?"":"hidden")">
                                                                    @*<p class="spnProductAmount"></p>*@
                                                                    <input type="number" onkeydown='OthersKeyDown(this, event)' class="txtProductAmount" />
                                                                    <span class="spnProductAmount"></span>
                                                                </td>
                                                                <td valign="top" class="tableActions">
                                                                    <i class="fa fa-trash-o trash-hidden" aria-hidden="true" title="@Localize.T("Delete")"></i>
                                                                </td>
                                                            </tr>

                                                                            if (Model.CustomerAppointmentServiceList.Count() == 0)
                                                                            {
                                                            <tr class="IsService">
                                                                <td class="hidden spnIsInvoiceCreate">false</td>
                                                                <td class="hidden spnReferenceInvoiceId"></td>
                                                                <td class="hidden spnReferenceInvoiceDetailId"></td>
                                                                <td class="hidden spnIsBilling">false</td>
                                                                <td class="hidden spnIsCopied">false</td>
                                                                <td valign="top"></td>
                                                                <td class="hidden spnIsBillingProcess">false</td>
                                                                <td valign="top" class="tick_product_name">
                                                                    <input type="text" class="ProductName" onkeydown="SearchKeyDown(this,event)" onkeyup="SearchKeyUp(this,event,'Service')" />
                                                                    <div class='tt-menu'><div class='tt-dataset tt-dataset-autocomplete'> </div> </div>
                                                                    <span class="spnProductName"></span>
                                                                </td>
                                                                @if (ShowDescriptionPermit)
                                                                {
                                                                    <td valign="top">
                                                                        <input type="text" onkeydown='OthersKeyDown(this,event)' class="txtProductDesc" />
                                                                        <span class="spnProductDesc"></span>
                                                                    </td>
                                                                }
                                                                <td valign="top">
                                                                    <p class="spnProductDesc spnSku"></p>
                                                                </td>
                                                                <td valign="top">
                                                                    <input type="number" onkeydown='OthersKeyDown(this, event)' class="txtProductQuantity" />
                                                                    <span class="spnProductQuantity" data-unitprice=""></span>
                                                                </td>
                                                                <td valign="top" class="@(ShowCost?"":"hidden")">
                                                                    <input type="number" onkeydown='OthersKeyDown(this, event)' class="txtProductUnitPrice" />
                                                                    <span class="spnProductRate"></span>
                                                                </td>
                                                                <td valign="top" class="@(ShowRetailPrice?"":"hidden")">
                                                                    @*<p class="spnProductAmount"></p>*@
                                                                    <input type="number" onkeydown='OthersKeyDown(this, event)' class="txtProductAmount" />
                                                                    <span class="spnProductAmount"></span>
                                                                </td>
                                                                <td valign="top" class="tableActions">
                                                                    <i class="fa fa-trash-o trash-hidden" aria-hidden="true" title="@Localize.T("Delete")"></i>
                                                                </td>
                                                            </tr>
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                                else
                                                                {
                                                                    if (AfterCompleteTicketItemAdd == true || Model.Ticket.Status != "Completed")
                                                                    {
                                                            <tr class="IsService">
                                                                <td class="hidden spnIsInvoiceCreate">false</td>
                                                                <td class="hidden spnReferenceInvoiceId"></td>
                                                                <td class="hidden spnReferenceInvoiceDetailId"></td>
                                                                <td class="hidden spnIsBilling">false</td>
                                                                <td class="hidden spnIsCopied">false</td>
                                                                <td valign="top"></td>
                                                                <td class="hidden spnIsBillingProcess">false</td>
                                                                <td valign="top" class="tick_product_name">
                                                                    <input type="text" class="ProductName" onkeydown="SearchKeyDown(this,event)" onkeyup="SearchKeyUp(this,event,'Service')" />
                                                                    <div class='tt-menu'><div class='tt-dataset tt-dataset-autocomplete'> </div> </div>
                                                                    <span class="spnProductName"></span>
                                                                </td>
                                                                @if (ShowDescriptionPermit)
                                                                {
                                                                    <td valign="top">
                                                                        <input type="text" onkeydown='OthersKeyDown(this,event)' class="txtProductDesc" />
                                                                        <span class="spnProductDesc"></span>
                                                                    </td>
                                                                }
                                                                <td valign="top">
                                                                    <p class="spnProductDesc spnSku"></p>
                                                                </td>
                                                                <td valign="top">
                                                                    <input type="number" onkeydown='OthersKeyDown(this, event)' class="txtProductQuantity" />
                                                                    <span class="spnProductQuantity" data-unitprice=""></span>
                                                                </td>
                                                                <td valign="top" class="@(ShowCost ? "" : "hidden")">
                                                                    <input type="number" onkeydown='OthersKeyDown(this, event)' class="txtProductUnitPrice" />
                                                                    <span class="spnProductRate"></span>
                                                                </td>
                                                                <td valign="top" class="@(ShowRetailPrice ? "" : "hidden")">
                                                                    @*<p class="spnProductAmount"></p>*@
                                                                    <input type="number" onkeydown='OthersKeyDown(this, event)' class="txtProductAmount" />
                                                                    <span class="spnProductAmount"></span>
                                                                </td>
                                                                <td valign="top" class="tableActions">
                                                                    <i class="fa fa-trash-o trash-hidden" aria-hidden="true" title="@Localize.T("Delete")"></i>
                                                                </td>
                                                            </tr>
                                                            <tr class="IsService">
                                                                <td class="hidden spnIsInvoiceCreate">false</td>
                                                                <td class="hidden spnReferenceInvoiceId"></td>
                                                                <td class="hidden spnReferenceInvoiceDetailId"></td>
                                                                <td class="hidden spnIsBilling">false</td>
                                                                <td class="hidden spnIsCopied">false</td>
                                                                <td valign="top"></td>
                                                                <td class="hidden spnIsBillingProcess">false</td>
                                                                <td valign="top" class="tick_product_name">
                                                                    <input type="text" class="ProductName" onkeydown="SearchKeyDown(this,event)" onkeyup="SearchKeyUp(this,event,'Service')" />
                                                                    <div class='tt-menu'><div class='tt-dataset tt-dataset-autocomplete'> </div> </div>
                                                                    <span class="spnProductName"></span>
                                                                </td>
                                                                @if (ShowDescriptionPermit)
                                                                {
                                                                    <td valign="top">
                                                                        <input type="text" onkeydown='OthersKeyDown(this,event)' class="txtProductDesc" />
                                                                        <span class="spnProductDesc"></span>
                                                                    </td>
                                                                }
                                                                <td valign="top">
                                                                    <p class="spnProductDesc spnSku"></p>
                                                                </td>
                                                                <td valign="top">
                                                                    <input type="number" onkeydown='OthersKeyDown(this, event)' class="txtProductQuantity" />
                                                                    <span class="spnProductQuantity" data-unitprice=""></span>
                                                                </td>
                                                                <td valign="top" class="@(ShowCost ? "" : "hidden")">
                                                                    <input type="number" onkeydown='OthersKeyDown(this, event)' class="txtProductUnitPrice" />
                                                                    <span class="spnProductRate"></span>
                                                                </td>
                                                                <td valign="top" class="@(ShowRetailPrice ? "" : "hidden")">
                                                                    @*<p class="spnProductAmount"></p>*@
                                                                    <input type="number" onkeydown='OthersKeyDown(this, event)' class="txtProductAmount" />
                                                                    <span class="spnProductAmount"></span>
                                                                </td>
                                                                <td valign="top" class="tableActions">
                                                                    <i class="fa fa-trash-o trash-hidden" aria-hidden="true" title="@Localize.T("Delete")"></i>
                                                                </td>
                                                            </tr>
                                                                    }
                                                                }
                                                            </tbody>
                                                        </table>
                                                        <table border="1" class="total-eqpservice">
                                                            <tbody>
                                                                <tr>
                                                                    <td>
                                                                        <span>@Localize.T("Total Price")</span>
                                                                    </td>
                                                                    <td>
                                                                        @if (Model.CustomerAppointmentServiceList != null)
                                                                        {
                                                                            <span id="spnUnitPrice">@Currency@LabelHelper.FormatAmount(Model.CustomerAppointmentServiceList.Sum(m => m.TotalPrice))</span>
                                                                        }
                                                                        else
                                                                        {
                                                                            <span id="spnUnitPrice">@Currency@LabelHelper.FormatAmount(0)</span>
                                                                        }
                                                                    </td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                                <div class="InvoiceCalculationsDiv InvoiceCalculationsDiv1 hidden">
                                                    <div class="WorkOrderTaxCalculation">
                                                        <div class="clearfix"><div class="text_bold">@Localize.T("Subtotal"):</div> <div class="text_normal amount">@HS.Web.UI.Helper.LabelHelper.CurrentTransMakeCurrency.MakeCurrency(null)</div></div>
                                                        <div class="clearfix"><div class="text_bold"><div class="tax_dropdown">@Html.DropDownListFor(x => x.CustomerAppointment.TaxPercent, (List<SelectListItem>)ViewBag.TaxListItem, new { @class = "form-control select_TaxList" })</div></div><div class="text_normal tax-amount">@HS.Web.UI.Helper.LabelHelper.CurrentTransMakeCurrency.MakeCurrency(null)</div></div>
                                                        <div class="clearfix"><div class="text_bold">@Localize.T("Total"):</div> <div class="text_normal total total_text_norm">@HS.Web.UI.Helper.LabelHelper.CurrentTransMakeCurrency.MakeCurrency(null)</div></div>

                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        @if (ViewBag.UpdateEqpServiceBtn == true)
                                        {
                                            <div class="ticket_create_update_btn">
                                                <button id="UpdateServiceList" class="btn cursor-pointer">
                                                    @Localize.T("Update Service List")
                                                </button>
                                            </div>
                                        }
                                    </div>
                                </td>
                            </tr>
                        }
                        <tr>
                            <td valign="top" colspan="2">
                                @if (Model.Ticket.Id > 0)
                                {
                                    <div class="ticket_reply_box">
                                        <ul class="nav nav-tabs" id="TicketActivityTabs">
                                            <li class="ticketNoteTab @(Model.ShowNoteFirst? "active": "")"><a data-target="#noteTab" data-toggle="tab" onclick="OpenNoteTicket()">@Localize.T("Note")</a></li>
                                            <li class="ticketLogTab @(Model.ShowNoteFirst? "": "active")"><a data-target="#logTab" data-toggle="tab" onclick="OpenLogTicket()">@Localize.T("Log")</a></li>

                                        </ul>
                                        <div class="tab-content">
                                            <div class="tab-pane @(Model.ShowNoteFirst? "": "active")" id="logTab">
                                                <div>&nbsp;</div>
                                                <div class="input-group">
                                                    <input class="form-control search_item_val" placeholder="Find Reply Message" type="text" name="search_item_val" />
                                                    <div class="input-group-btn">
                                                        <button class="btn" onclick="SearchReplyTicketLog()"><i class="fa fa-search"></i></button>
                                                    </div>
                                                </div>
                                                <div>&nbsp;</div>
                                                <div class="LoadTicketLogItem"></div>
                                            </div>

                                            <div class="tab-pane @(Model.ShowNoteFirst? "active": "")" id="noteTab">
                                                <div>&nbsp;</div>
                                                <div class="input-group">
                                                    <input class="form-control search_item_val_note" placeholder="Find Reply Message" type="text" name="search_item_val_note" />
                                                    <div class="input-group-btn">
                                                        <button class="btn" onclick="SearchReplyTicketNote()"><i class="fa fa-search"></i></button>
                                                    </div>
                                                </div>
                                                <div>&nbsp;</div>
                                                <div class="LoadTicketNoteItem"></div>
                                            </div>
                                        </div>
                                    </div>
                                }
                            </td>
                        </tr>
                        <tr class="Reply_Space">
                            <td valign="top" colspan="2">
                                <b>@Localize.T("Add Reply")</b>

                                <textarea id="BodyContent" name="BodyContent" class="tinymce"></textarea>
                            </td>
                        </tr>

                        <tr class="Reply_button">
                            <td>
                                @if (PermissionChekcer.IsPermitted(Permissions.MenuPermissions.TicketNotificationSetting))
                                {
                                    <button class="btn" id="TicketCustomerNotification" onclick="loadTicketNotifySetting()">@Localize.T("Notification Settings")</button>
                                }
                                @if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.IsAgreementTicket))
                                {
                                    <input id="IsAgreementTicket" @(Model.Ticket.IsAgreementTicket == true ? "checked" : "") type="checkbox" />
                                    <b>@Localize.T("Is Agreement Ticket")</b>
                                }
                            </td>
                            <td class="text-right">
                                @if (PermissionChekcer.IsPermitted(Permissions.CustomerPermissions.TicketNotifythecustomer))
                                {
                                    <input id="NotifyCustomer" checked="checked" type="checkbox" />
                                    <b>@Localize.T("Notify the customer")</b>
                                }
                                @if (PermissionChekcer.IsPermitted(Permissions.CustomerPermissions.TicketIsPrivate))
                                {
                                    <input type="checkbox" id="privetmsg" />
                                    <b>@Localize.T("Private")</b>
                                }

                                <input type="checkbox" id="overview_show" />
                                <b>@Localize.T("Show in Overview")</b>
                                @*<button class="btn" id="MakeReply"> @Localize.T("Reply") </button>*@
                            </td>
                        </tr>


                    }
                    else
                    {
                        <tr>
                            <td colspan="2">


                                <div class="ticket_reply_box_add">
                                    <table class="ticketTable @((Model.Ticket.Status == TickStat.Init)?"table_style_for_new":"")">
                                        @if (Model.Ticket.CustomerId == Guid.Empty)
                                        {
                                            <tr>
                                                <td class="w27p">
                                                    <b>@Localize.T("Customer")</b>
                                                </td>
                                                <td>
                                                    <div class="col-md-5 padding-left-0">
                                                        @Html.DropDownList("CustomerList", (List<SelectListItem>)ViewBag.CustomerList, new { @class = "form-control dropdown_customar", datarequired = "false" })
                                                    </div>
                                                </td>
                                            </tr>
                                        }
                                        <tr>
                                            <td class="w27p @((Model.Ticket.Status == TickStat.Init)?"":"ticket_type_info_bg")">
                                                <b>@Localize.T("Ticket Type")</b>
                                            </td>
                                            <td class="@((Model.Ticket.Status == TickStat.Init)?"":"ticket_type_info_bg")">
                                                <div class="col-md-5 padding-left-0">

                                                    @if (Model.Ticket.Status == TickStat.Init)
                                                    {
                                                        @Html.DropDownListFor(x => x.Ticket.TicketType, ViewBag.TicketType as List<SelectListItem>, new { @class = "form-control", datarequired = "true" })

                                                    }
                                                    else
                                                    {
                                                        <span>@Model.Ticket.TicketTypeVal</span>
                                                    }

                                                </div>
                                            </td>
                                        </tr>
                                        @if (PermissionChekcer.IsPermitted(Permissions.CustomerPermissions.CustomerTicketReason))
                                        {
                                            <tr>
                                                <td class="w27p">
                                                    <b>@Localize.T("Reason")</b>
                                                </td>
                                                <td class="">
                                                    <div class="col-md-5 padding-left-0">
                                                        @Html.DropDownList("ReasonMembers", ViewBag.ReasonList as List<SelectListItem>, new { @class = "form-control selectpicker", @multiple = "multiple" })
                                                    </div>
                                                </td>
                                            </tr>
                                        }
                                        @if (Model.Ticket.Status == TickStat.Init)
                                        {
                                            <tr>
                                                <td valign="top">


                                                    <b class="ticket_manual_top">@Localize.T("Ticket") Description</b>
                                                </td>
                                                <td>
                                                    <textarea id="BodyContent" name="BodyContent" class="tinymce">@Model.Ticket.Message</textarea>
                                                </td>
                                            </tr>
                                        }
                                    </table>

                                </div>
                            </td>
                        </tr>
                    }
                </table>

            </div>
            <div class="ticket_info col-md-4">
                <div class="ticketInfoTable">
                    <div class="ticketInfoTable_row add_ticket_schedule">
                        <div class="add_ticket_top_btn_div">
                            @if (PermissionChekcer.IsPermitted(Permissions.CustomerPermissions.RescheduleTicket))
                            {
                                if (Model.Ticket.RescheduleTicketId == 0)
                                {
                                    <a class="btn" id="RescheduleTicketPopup">@Localize.T("Reschedule")</a>
                                }
                            }
                            @if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.CustomerTicketCreateInvoice))
                            {
                                if (Model.Ticket.Id > 0)
                                {
                                    <a class="btn create_inv_ticket" onclick="CreateInvoiceTicketAddItem()">@Localize.T("Create Invoice")</a>
                                }
                            }
                        </div>
                        <div>
                            <b>@Localize.T("Scheduled On")</b>
                        </div>
                        <div class="input_group_for_date add-on scheduleoncontainer">
                            @if (!PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.TicketScheduleOnPermission))
                            {
                                string StringValue = (Model.Ticket.CompletionDate == new DateTime() ? "" : Model.Ticket.CompletionDate.ToString("MM/dd/yy"));

                                <input type="text" style="border-radius: 5px 0px 0px 5px;" id="Ticket_CompletionDate" autocomplete="off" class="form-control" value="@StringValue" readonly />
                                <button disabled class="btn" style="border-radius: 0px 5px 5px 0px;" id="btnSchedule"><i class="fa fa-calendar" aria-hidden="true" style="cursor:pointer;"></i></button>
                            }
                            else
                            {
                                string StringValue = (Model.Ticket.CompletionDate == new DateTime() ? "" : Model.Ticket.CompletionDate.ToString("MM/dd/yy"));

                                <input type="text" style="border-radius: 5px 0px 0px 5px;" id="Ticket_CompletionDate" autocomplete="off" class="form-control CompletionDate" value="@StringValue" />
                                <button class="btn" style="border-radius: 0px 5px 5px 0px;" id="btnSchedule"><i class="fa fa-calendar" aria-hidden="true" style="cursor:pointer;"></i></button>

                            }


                        </div>
                    </div>
                    <div class="ticketInfoTable_row add_ticket_start_end_time">
                        <div class="col-md-6 padding-left-0 padding-right-5">
                            <b><span class="aso_span">@Localize.T("Start Time")</span></b>
                            @if (!PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.TicketStartTimePermission))
                            {
                                @Html.DropDownListFor(model => model.Ticket.AppointmentStartTime, (List<SelectListItem>)ViewBag.AppointmentTime, new { @class = "form-control select_search", @style = "width:100%;", @disabled = "disabled", id = "AppointmentStartTime" })

                            }
                            else
                            {
                                @Html.DropDownListFor(model => model.Ticket.AppointmentStartTime, (List<SelectListItem>)ViewBag.AppointmentTime, new { @class = "form-control select_search", @style = "width:100%;", id = "AppointmentStartTime" })
                            }
                        </div>
                        <div class="col-md-6 padding-right-0 padding-left-5">
                            <b><span class="aso_span">@Localize.T("End Time")</span></b>
                            @if (!PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.TicketEndTimePermission))
                            {
                                @Html.DropDownListFor(model => model.Ticket.AppointmentEndTime, (List<SelectListItem>)ViewBag.AppointmentTime, new { @class = "form-control select_search", @disabled = "disabled", @style = "width:100%;", id = "AppointmentEndTime" })
                            }
                            else
                            {
                                @Html.DropDownListFor(model => model.Ticket.AppointmentEndTime, (List<SelectListItem>)ViewBag.AppointmentTime, new { @class = "form-control select_search", @style = "width:100%;", id = "AppointmentEndTime" })

                            }

                        </div>
                    </div>
                    @if (Model.Ticket.Status != TickStat.Init && PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.TicketTypeChange))
                    {
                        <div class="ticketInfoTable_row add_ticket_btn add_ticket_padd_right">
                            <div>
                                <b>@Localize.T("Ticket Type")</b>
                            </div>
                            <div>
                                @Html.DropDownListFor(x => x.Ticket.TicketType, ViewBag.TicketType as List<SelectListItem>, new { @class = "form-control", datarequired = "true" })
                            </div>
                        </div>
                    }
                    <div class="ticketInfoTable_row add_ticket_btn add_ticket_padd_right">
                        <div>
                            <b>@Localize.T("Assigned To")</b> <span class="hidden" id="spanText" style="color: red; font-size: 12px;"></span>
                        </div>
                        <div>
                            @if (!PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.TicketAssignedPermission))
                            {
                                <select class="form-control" disabled="disabled" id="AssignedTo">
                                    <option value="-1">@Localize.T("Select One")</option>
                                    @foreach (var item in (List<HS.Entities.Employee>)ViewBag.TechnicianList)
                                    {
                                        <option @(Model.TicketAssignedUserList.Count(y => y.UserId == item.UserId) > 0 ? "selected" : "") value="@item.UserId" email="@item.Email" phone="@item.Phone">@item.FirstName @item.LastName</option>
                                    }
                                    <option value="22222222-2222-2222-2222-222222222222">System User</option>
                                </select>
                                @*@Html.DropDownListFor(m => m.Ticket.AssignedToId, ViewBag.AssignedEmployee as List<SelectListItem>, new { @class = "form-control", @disabled = "disabled", id = "AssignedTo" })*@
                            }
                            else
                            {
                                <select class="form-control" id="AssignedTo">
                                    <option value="00000000-0000-0000-0000-000000000000">@Localize.T("Select One")</option>
                                    <option @(SystemUserSelect ? "selected" : "") value="22222222-2222-2222-2222-222222222222">System User</option>
                                    @foreach (var item in (List<HS.Entities.Employee>)ViewBag.TechnicianList)
                                    {
                                        <option @(Model.TicketAssignedUserList.Count(y => y.UserId == item.UserId) > 0 ? "selected" : "") value="@item.UserId" email="@item.Email" phone="@item.Phone">@item.FirstName @item.LastName</option>
                                    }
                                </select>

                                @*@Html.DropDownList("AssignedTo", ViewBag.AssignedEmployee as List<SelectListItem>, new { @class = "form-control" })*@

                            }
                        </div>
                        @if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.ShowAssignToDetail))
                        {
                            <div class="ticketInfoTable_row">
                                <div class="AssignedPersonContactInfo form-control disabled" style="height:unset;">
                                    <b>Phone:</b> <span class="AssignedPhone"></span> <br />
                                    <b>Email:</b> <span class="AssignedEmail"></span>
                                </div>
                            </div>
                        }
                    </div>

                    <div class="ticketInfoTable_row add_ticket_btn add_ticket_padd_left additionalmembers">
                        <div>
                            <b>@Localize.T("Additional Members")</b>
                            @if (Model.Ticket.Id > 0 && PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.TicketAdditionalPermission))
                            {
                                <a class="cus-anchor" id="MemberAppointmentPopup" title="Set Appointment"><i class="fa fa-calendar-times-o" aria-hidden="true"></i></a>
                            }

                        </div>
                        <div class="ld_add_member">
                            <div class="load_additional_members">

                            </div>
                            @if (Model.Ticket.Id > 0)
                            {
                                if (Model.memberAppointment.Count > 0)
                                {
                                    <div class="ld_add_member_table">

                                        <table>
                                            <tr>
                                                <th>@Localize.T("Name")</th>
                                                <th>@Localize.T("Start Time")</th>
                                                <th>@Localize.T("End Time")</th>
                                            </tr>
                                            @foreach (var item in Model.memberAppointment)
                                            {
                                                <tr>
                                                    <td>@item.EmpName</td>
                                                    <td>@item.StartTime</td>
                                                    <td>@item.EndTime</td>
                                                </tr>
                                            }
                                        </table>

                                    </div>
                                }

                            }
                        </div>
                    </div>
                    @if (ViewBag.IsShowNotifyingMember == "true")
                    {
                        <div class="ticketInfoTable_row add_ticket_btn add_ticket_padd_right notifyingmembers">
                            <div>
                                <b>@Localize.T("Notifying Members")</b>
                            </div>
                            <div>
                                @Html.DropDownList("NotifyingMembers", ViewBag.NotifyingUserList as List<SelectListItem>, new { @class = "form-control selectpicker", @multiple = "multiple" })
                            </div>
                        </div>
                    }

                    @if ((Model.Ticket.Id > 0) && PermissionChekcer.IsPermitted(Permissions.CustomerPermissions.CustomerTicketReason))
                    {
                        <div class="ticketInfoTable_row add_ticket_btn add_ticket_padd_right reasonmembers">
                            <div>
                                <b>@Localize.T("Ticket Reason")</b>
                            </div>
                            <div>
                                @Html.DropDownList("ReasonMembers", ViewBag.ReasonList as List<SelectListItem>, new { @class = "form-control selectpicker", @multiple = "multiple" })
                            </div>
                        </div>
                    }



                    <div class="ticketInfoTable_row add_ticket_status">
                        <div>
                            <b>@Localize.T("Status")</b>
                        </div>
                        <div>
                            @{
                                if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.ChangeTicketStatusPermission))
                                {
                                    @Html.DropDownListFor(x => x.Ticket.Status, ViewBag.TicketStatus as List<SelectListItem>, new { @class = "form-control", datarequired = "true", @onchange = "SaveCompletedDateTicket()" })
                                }
                                else
                                {
                                    @Html.DropDownListFor(x => x.Ticket.Status, ViewBag.TicketStatus as List<SelectListItem>, new { @class = "form-control", datarequired = "true", @onchange = "SaveCompletedDateTicket()", @disabled = "disabled" })
                                }
                            }
                        </div>

                    </div>
                    @if (PermissionChekcer.IsPermitted(Permissions.CustomerPermissions.CustomerTicketRugLocation)
&& Model.Ticket.TicketType == LabelHelper.TicketType.DropOff)
                    {

                        @*<div>
                                <div>
                                    <b>@Localize.T("Rack # (1-35)")</b>
                                </div>
                                <div>
                                    @Html.TextBoxFor(x => x.Ticket.RackNo, new { @class = "form-control", datarequired = "true" })
                                </div>
                            </div>*@

                        <div class="ticketInfoTable_row">
                            <div>
                                <b>@Localize.T("Location")</b>
                            </div>
                            <div>
                                @Html.DropDownListFor(x => x.Ticket.Locations, ViewBag.TicketLocationList as List<SelectListItem>, new { @class = "form-control", datarequired = "true" })

                            </div>
                        </div>
                    }
                    @if (PermissionChekcer.IsPermitted(Permissions.CustomerPermissions.CustomerTicketCompletedDate))
                    {
                        var CompletedDate = "";
                        if (Model.Ticket.CompletedDate != null && Model.Ticket.CompletedDate != new DateTime())
                        {
                            CompletedDate = Model.Ticket.CompletedDate.Value.ToShortDateString();
                        }
                        else
                        {
                            CompletedDate = DateTime.UtcNow.UTCToClientTime().ToShortDateString();
                        }
                        <div class="ticketInfoTable_row add_ticket_completeddate hidden" id="DivCompletedDate">
                            <div>
                                <b>@Localize.T("Completed Date")</b>
                            </div>
                            <div class="scheduleoncontainer">
                                <input type="text" style="border-radius: 5px 0px 0px 5px;" id="Ticket_CompletedDate" autocomplete="off" class="form-control" value="@CompletedDate" />
                            </div>
                        </div>
                    }
                    @if (Model.Ticket.Status != TickStat.Init)
                    {
                        if (PermissionChekcer.IsPermitted(Permissions.CustomerPermissions.TicketSurvey))
                        {
                            <div class="ticketInfoTable_row add_survey_status">
                                <div>
                                    <b>@Localize.T("Start Survey")</b>
                                </div>
                                <div class="input-group add-on">
                                    @Html.DropDownList("Survey", ViewBag.SurveyList as List<SelectListItem>, new { @class = "form-control" })
                                    <div class="input-group-btn"> <button class="btn green_button" id="SurveySave" onclick="SaveSurveyForTicket('@Model.Ticket.TicketId')" title="@Localize.T("Send")"> <i class="fa fa-paper-plane"></i></button></div>
                                </div>

                            </div>
                        }
                        else
                        {
                            if (Model.Ticket.IsClosed == true && Model.Ticket.HasSurvey == false)
                            {
                                <div class="ticketInfoTable_row add_survey_status">
                                    <div>
                                        <b>@Localize.T("Start Survey")</b>
                                    </div>


                                    <div class="input-group add-on">
                                        @Html.DropDownList("Survey", ViewBag.SurveyList as List<SelectListItem>, new { @class = "form-control " })

                                        <div class="input-group-btn"> <button class="btn green_button" id="SurveySave" onclick="SaveSurveyForTicket('@Model.Ticket.TicketId')" title="@Localize.T("Send")"> <i class="fa fa-paper-plane"></i></button></div>
                                    </div>

                                </div>
                            }
                        }
                    }
                </div>
                <div class="ticket_button_timer_container">
                    @if (Model.Ticket.Status != TickStat.Init)
                    {
                        if (PermissionChekcer.IsPermitted(Permissions.CustomerPermissions.CloseAndOpenTicketPermission))
                        {
                            <div class="ticket_button_con">
                                <input type="checkbox" @(Model.Ticket.IsClosed == true ? "" : "checked") id="StatusToogle" data-toggle="toggle" data-on="Open" data-off="Closed" data-onstyle="success" data-offstyle="danger">
                            </div>
                        }
                        else
                        {
                            <div class="ticket_button_con hidden">
                                <input type="checkbox" @(Model.Ticket.IsClosed == true ? "" : "checked") id="StatusToogle" data-toggle="toggle" data-on="Open" data-off="Closed" data-onstyle="success" data-offstyle="danger">
                            </div>
                        }

                        @*else
                            {
                                <div class="ticket_button_con">
                                    <input type="checkbox" @(Model.Ticket.IsClosed == true ? "disabled" : "checked") id="StatusToogle" data-toggle="toggle" data-on="Open" data-off="Closed" data-onstyle="success" data-offstyle="danger">
                                </div>
                            }*@
                        if (PermissionChekcer.IsPermitted(Permissions.MyCompanyPermissions.TicketTimer))
                        {
                            <div class="ticket_timer_container">

                                <div class="ticket_timer_inner">
                                    <i class="fa fa-play-circle jobstart" onClick="ClockInOut('start')" title="Start"></i>
                                    <i class="fa fa-stop-circle jobend" onClick="ClockInOut('stop')" title="Stop"></i>
                                    <div class="timer watch"></div>
                                </div>
                            </div>
                        }
                        if (PermissionChekcer.IsPermitted(Permissions.CustomerPermissions.CustomerTicketDispatch) && (!Model.Ticket.IsDispatch.HasValue || Model.Ticket.IsDispatch == false))
                        {
                            <div class="ticket_dispatch_container">
                                <button class="btn" id="DispatchBtn">@Localize.T("Dispatch")</button>
                            </div>
                        }
                        @*if (PermissionChekcer.IsPermitted(Permissions.CustomerPermissions.CustomerTicketAgreement) && (Model.Ticket.TicketType != "Service"))
                            {
                                <div class="ticket_dispatch_container">
                                    <button class="btn" data-val="@Model.Ticket.TicketType" data-id="@Model.Ticket.Id" id="AgreementBtn">@Localize.T("Agreement")</button>
                                </div>
                            }*@
                    }
                    @if (Model.InvoiceBalanceDue != 0.0 && !PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.TicketBalanceDuePermission))
                    {

                        <div class="ticket_balance_text">
                            <a href="javascript:void(0);" class="TicBalanceDue">
                                Balance Due : @HS.Web.UI.Helper.LabelHelper.CurrentTransMakeCurrency.MakeCurrency(null)<span class="TotalBalanceDueAmount">@HS.Web.UI.Helper.LabelHelper.FormatAmount(Model.InvoiceBalanceDue)</span>
                            </a>
                        </div>
                    }
                    <div class="BookingTotalAmount hidden" style="width:100%;float:left;padding-top:5px;">
                        <label>Total Amount: @HS.Web.UI.Helper.LabelHelper.CurrentTransMakeCurrency.MakeCurrency(null)<span class="balanceDueAmount"></span></label>
                    </div>
                    <div class="BookingTotalAmountChanged hidden" style="width:100%;float:left;">
                        <label>Amount Changed: @HS.Web.UI.Helper.LabelHelper.CurrentTransMakeCurrency.MakeCurrency(null)<span class="AmountChanged">0.00</span></label>
                    </div>
                </div>
                @if (Model.Ticket.Status != TickStat.Init)
                {
                    if (PermissionChekcer.IsPermitted(Permissions.MyCompanyPermissions.TicketGenerateDocument))
                    {
                        <div class="dropdown ticket_generate_docu">
                            <button class="btn dropdown-toggle" data-toggle="dropdown" aria-expanded="false">Generate Document</button>
                            <ul class="dropdown-menu">
                                @if (PermissionChekcer.IsPermitted(Permissions.MyCompanyPermissions.TicketRecreateAgreement))
                                {
                                    <li>
                                        @if (PermissionChekcer.IsPermitted(Permissions.MyCompanyPermissions.ShowAgreementinfoPopup))
                                        {
                                            <button class="btn" @*onClick="RecreateAgreement(@Model.Customer.Id, @Model.Ticket.Id)"*@ onclick="SendAgreementPopup('Recreate')">Recreate Agreement</button>
                                        }
                                        else
                                        {
                                            <button class="btn" onClick="RecreateAgreement(@Model.Customer.Id, @Model.Ticket.Id)">Recreate Agreement</button>
                                        }
                                    </li>
                                }
                                @if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.ShowCreateAddendum))
                                {
                                    <li>
                                        <button class="btn" onclick="loadCreateAddendum()">Create Addendum</button>
                                    </li>
                                }
                                @if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.FirstPagePermission))
                                {
                                    <li>
                                        @if (PermissionChekcer.IsPermitted(Permissions.MyCompanyPermissions.ShowAgreementinfoPopup))
                                        {
                                            <button class="btn" @*onclick="loadFirstPage(@Model.Customer.Id, @Model.Ticket.Id)"*@ onclick="SendAgreementPopup('FirstPage')">First Page</button>
                                        }
                                        else
                                        {
                                            <button class="btn" onclick="loadFirstPage(@Model.Customer.Id, @Model.Ticket.Id)">First Page</button>
                                        }
                                    </li>
                                }
                                @*@if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.TicketCommercialAgreement))
                                    {
                                        <li>
                                            <button class="btn" onclick="loadCommercialAgreement(@Model.Customer.Id, @Model.Ticket.Id)">Commercial Agreement</button>
                                        </li>
                                    }*@
                            </ul>
                        </div>
                    }
                    if (PermissionChekcer.IsPermitted(Permissions.MyCompanyPermissions.TicketSmartSetup))
                    {
                        <div class="smart-set-up">
                            <button class="btn" onClick="SmartSetup()">Smart Setup</button>
                        </div>
                    }
                    if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.CodeSafetyDocument))
                    {
                        <div class="smart-set-up">
                            <button class="btn" onclick="CreateCodeDocument(@Model.Ticket.Id)">@Localize.T("Code Safety")</button>
                        </div>
                    }
                }


                @if (Model.Ticket.Id != 0)
                {
                    if (PermissionChekcer.IsPermitted(Permissions.MyCompanyPermissions.TicketClone))
                    {
                        <div class="clone_ticket_btn">
                            <button class="btn" onclick="RescheduleTicketConfirmation()">Follow Up</button>
                            <button class="btn" onClick="CloneTicketConfirm()">Clone @Localize.T("Ticket")</button>
                        </div>
                    }
                }
                @if (PermissionChekcer.IsPermitted(Permissions.MyCompanyPermissions.ShowContractSignedOrNot))
                {
                    <div class="contract_sign_stat">
                        @{
                            if (Model.Customer.IsContractSigned == true)
                            {
                                <span class="green_status">@Localize.T("Contract Signed")</span>
                            }
                            else
                            {
                                <span class="red_status">@Localize.T("Contract Not Signed")</span>
                            }
                        }

                    </div>
                }
                @if (PermissionChekcer.IsPermitted(Permissions.MyCompanyPermissions.ShowContractSignedUpdateButton))
                {
                    <div class="contract_sign_button">
                        @{
                            if (Model.Customer.IsContractSigned == true)
                            {
                                <button class="float-right btn btn-danger" style="margin-top:-30px;" onclick="updatecontractsigned(@Model.Customer.Id)">@Localize.T("Not Signed")</button>
                            }
                            else
                            {
                                <button class="float-right btn green_button" style="margin-top:-30px;" onclick="updatecontractsigned(@Model.Customer.Id)">@Localize.T("Signed")</button>
                            }
                        }

                    </div>
                }
            </div>
        </div>
        @if (Model.Ticket.Status != TickStat.Init && ViewBag.IsCommissionCalculation == true && PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.ShowCommissionCalculationInTicket))
        {
            <div class="ticket_bottom_block">
                @if (Model.SalesCommissionList != null && Model.SalesCommissionList.Count > 0 || PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.AddSalesCommission))
                {

                    <div class="ticket_bottom_block_inner">
                        <div class="ticket_table_header">
                            Sales Commission
                            @if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.AddSalesCommission))
                            {
                                <button class="btn" onclick="AddSalesCommission()" title="Add Sales Commission"><i class="fa fa-plus"></i></button>
                            }
                        </div>
                        @if (Model.SalesCommissionList != null && Model.SalesCommissionList.Count > 0)
                        {
                            <div class="ticket_commission_table_container">
                                <table class="sales_commission_table">
                                    <thead>
                                        <tr>
                                            <th>
                                                Sales Person
                                            </th>
                                            <th>
                                                RMR Commission
                                            </th>
                                            @*<th>
                                                    Equipment Commission
                                                </th>*@
                                            @{
                                                if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.CommissionAdjustment))
                                                {
                                                    <th>
                                                        Equipment Commission
                                                    </th>
                                                }
                                            }
                                            <th>
                                                Total Commission
                                            </th>
                                            <th>
                                                Point
                                            </th>
                                            <th>
                                                Point Differrence
                                            </th>
                                            @{
                                                if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.CommissionAdjustment))
                                                {
                                                    <th>
                                                        Point Adjustment
                                                    </th>
                                                }
                                            }
                                            @if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.CommissionDelete))
                                            {
                                                <th>
                                                    Action
                                                </th>
                                            }
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var item in Model.SalesCommissionList)
                                        {
                                            <tr>
                                                <td>@item.SalesPerson</td>
                                                <td>
                                                    <span id="labelSalesRmrCommission_@item.Id">
                                                        @Currency@LabelHelper.FormatAmount(item.RMRCommission)
                                                    </span>
                                                    @if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.RMRCommissionEdit))
                                                    {
                                                        <i class="fa fa-edit cursor-pointer" id="btnSalesRmrCommission_@item.Id" onclick="EditSalesRmrCommission('@item.Id')"></i>
                                                        <div id="divSalesRmrCommission_@item.Id" class="hidden">
                                                            <input type="text" id="txtSalesRmrComission_@item.Id" value="@LabelHelper.FormatAmount(item.RMRCommission)" style="width:35%" />
                                                            <span id="updateSalesRmrCommission_@item.Id" class="cursor-pointer" onclick="UpdateSalesRmrCommission('@item.Id')">&#10004;</span>
                                                            <span id="exitSalesRmrCommission_@item.Id" class="cursor-pointer" onclick="ExitSalesRmrCommission('@item.Id')">&#10008;</span>
                                                        </div>
                                                    }
                                                    @if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.ShowCommissionCalculation) && item.RMRCommission != 0 && !string.IsNullOrEmpty(item.RMRCommissionCalculation))
                                                    {
                                                        <br /><span style="font-weight:bold">Calculation:</span><br />
                                                        @Html.Raw(item.RMRCommissionCalculation)
                                                    }
                                                </td>
                                                @*<td>
                                                        @Currency@LabelHelper.FormatAmount(item.EquipmentCommission)<br />
                                                        @if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.ShowCommissionCalculation) && item.EquipmentCommission != 0 && !string.IsNullOrEmpty(item.EquipmentCommissionCalculation))
                                                        {
                                                            <span style="font-weight:bold">Calculation:</span><br />
                                                            @Html.Raw(item.EquipmentCommissionCalculation)
                                                        }
                                                    </td>*@
                                                @{
                                                    if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.CommissionAdjustment))
                                                    {
                                                        <td>
                                                            @{
                                                                if (item.Adjustment > 0)
                                                                {
                                                                    <input type="number" class="form-control adjustment_sales_comission" value="@string.Format("{0:#,##0.00}", item.Adjustment)" data-id="@item.SalesCommissionId" data-val="@item.Id">
                                                                }
                                                                else if (item.Adjustment < 0)
                                                                {
                                                                    <input type="number" class="form-control adjustment_sales_comission" value="@string.Format("{0:#,##0.00}", item.Adjustment)" data-id="@item.SalesCommissionId" data-val="@item.Id">
                                                                }
                                                                else
                                                                {
                                                                    <input type="number" class="form-control adjustment_sales_comission" value="0.00" data-id="@item.SalesCommissionId" data-val="@item.Id">
                                                                }
                                                            }
                                                        </td>

                                                    }

                                                }
                                                <td>
                                                    <span class="sales_total_comission_prev_@item.Id">@Currency@LabelHelper.FormatAmount(item.TotalCommission)</span>
                                                    <span class="sales_total_comission_@item.Id"></span>
                                                </td>
                                                <td>
                                                    <span class="sales_total_point_prev_@item.Id">@LabelHelper.FormatAmount(item.OriginalPoint)</span>
                                                    <span class="sales_total_point_@item.Id"></span>
                                                </td>
                                                <td>
                                                    <span class="mainadjustablepoint_sales_@item.Id">@LabelHelper.FormatAmount(item.AdjustablePoint)</span>
                                                </td>
                                                @{
                                                    if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.CommissionAdjustment))
                                                    {
                                                        <td>
                                                            <input type="number" class="form-control adjustmentpoint_sales_comission" value="0.00" data-id="@item.SalesCommissionId" data-val="@item.Id">
                                                        </td>
                                                    }
                                                }
                                                @if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.CommissionDelete))
                                                {
                                                    <td>
                                                        <a data-toggle="tooltip" title="Delete" onclick="DeleteCommission('SalesCommission',@item.Id)"><i class="fa fa-trash-o"></i></a>
                                                    </td>
                                                }
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                        }
                    </div>
                }
                @if (Model.TechCommissionList != null && Model.TechCommissionList.Count > 0 || PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.AddTechCommission))
                {


                    <div class="ticket_bottom_block_inner">
                        <div class="ticket_table_header">
                            Tech Pay
                            @if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.AddTechCommission))
                            {
                                <button class="btn" onclick="AddTechCommission()" title="Add Tech Commission"><i class="fa fa-plus"></i></button>
                            }
                        </div>
                        @if (Model.TechCommissionList != null && Model.TechCommissionList.Count > 0)
                        {
                            <div class="ticket_commission_table_container">
                                <table class="tech_commission_table">
                                    <thead>
                                        <tr>
                                            <th>
                                                Technician
                                            </th>
                                            <th>
                                                Base RMR Pay
                                            </th>
                                            @*<th>
                                                    Added RMR Commission
                                                </th>*@
                                            @if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.CommissionAdjustment))
                                            {
                                                <th>
                                                    Labor
                                                </th>
                                            }
                                            <th>
                                                Total Pay
                                            </th>
                                            <th>
                                                Point
                                            </th>
                                            <th>
                                                Point Differrence
                                            </th>
                                            @{
                                                if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.CommissionAdjustment))
                                                {
                                                    <th>
                                                        Point Adjustment
                                                    </th>
                                                }
                                            }
                                            @if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.CommissionDelete))
                                            {
                                                <th>
                                                    Action
                                                </th>
                                            }
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var item in Model.TechCommissionList)
                                        {
                                            <tr>
                                                <td>@item.Technician</td>
                                                <td>
                                                    <span id="labelTechRmrCommission_@item.Id">
                                                        @Currency@LabelHelper.FormatAmount(item.BaseRMRCommission)
                                                    </span>
                                                    @if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.RMRCommissionEdit))
                                                    {
                                                        <i class="fa fa-edit cursor-pointer" id="btnTechRmrCommission_@item.Id" onclick="EditTechRmrCommission('@item.Id')"></i>
                                                        <div id="divTechRmrCommission_@item.Id" class="hidden">
                                                            <input type="text" id="txtTechRmrComission_@item.Id" value="@LabelHelper.FormatAmount(item.BaseRMRCommission)" style="width:35%" />
                                                            <span id="updateTechRmrCommission_@item.Id" class="cursor-pointer" onclick="UpdateTechRmrCommission('@item.Id')">&#10004;</span>
                                                            <span id="exitTechRmrCommission_@item.Id" class="cursor-pointer" onclick="ExitTechRmrCommission('@item.Id')">&#10008;</span>
                                                        </div>
                                                    }
                                                    @if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.ShowCommissionCalculation) && item.BaseRMRCommission != 0 && !string.IsNullOrEmpty(item.BaseRMRCommissionCalculation))
                                                    {
                                                        <br /><span style="font-weight:bold">Calculation:</span><br />
                                                        @Html.Raw(item.BaseRMRCommissionCalculation)
                                                    }
                                                </td>
                                                @{
                                                    if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.CommissionAdjustment))
                                                    {
                                                        <td>
                                                            @{
                                                                if (item.Adjustment > 0)
                                                                {
                                                                    <input type="number" class="form-control adjustment_tech_comission" value="@string.Format("{0:#,##0.00}", item.Adjustment)" data-id="@item.TechCommissionId" data-val="@item.Id">
                                                                }
                                                                else if (item.Adjustment < 0)
                                                                {
                                                                    <input type="number" class="form-control adjustment_tech_comission" value="@string.Format("{0:#,##0.00}", item.Adjustment)" data-id="@item.TechCommissionId" data-val="@item.Id">
                                                                }
                                                                else
                                                                {
                                                                    <input type="number" class="form-control adjustment_tech_comission" value="0.00" data-id="@item.TechCommissionId" data-val="@item.Id">
                                                                }
                                                            }
                                                        </td>

                                                    }

                                                }
                                                <td>
                                                    <span class="tech_total_comission_prev_@item.Id">@Currency@LabelHelper.FormatAmount(item.TotalCommission)</span>
                                                    <span class="tech_total_comission_@item.Id"></span>
                                                </td>
                                                <td>
                                                    <span class="tech_total_point_prev_@item.Id">@LabelHelper.FormatAmount(item.OriginalPoint)</span>
                                                    <span class="tech_total_point_@item.Id"></span>
                                                </td>
                                                <td>
                                                    <span class="mainadjustablepoint_tech_@item.Id">@LabelHelper.FormatAmount(item.AdjustablePoint)</span>
                                                </td>
                                                @{
                                                    if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.CommissionAdjustment))
                                                    {
                                                        <td>
                                                            <input type="number" class="form-control adjustmentpoint_tech_comission" value="0.00" data-id="@item.TechCommissionId" data-val="@item.Id">
                                                        </td>
                                                    }
                                                }
                                                @if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.CommissionDelete))
                                                {
                                                    <td>
                                                        <a data-toggle="tooltip" title="Delete" onclick="DeleteCommission('TechCommission',@item.Id)"><i class="fa fa-trash-o"></i></a>
                                                    </td>
                                                }
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                        }
                    </div>
                }
                @if (Model.AddMemberCommissionList != null && Model.AddMemberCommissionList.Count > 0 || PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.AddAddMemberCommission))
                {

                    <div class="ticket_bottom_block_inner">
                        <div class="ticket_table_header">
                            Additional Members Pay
                            @if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.AddAddMemberCommission))
                            {
                                <button class="btn" onclick="AddAddMemberCommission()" title="Add Additional Members Commission"><i class="fa fa-plus"></i></button>
                            }
                        </div>
                        @if (Model.AddMemberCommissionList != null && Model.AddMemberCommissionList.Count > 0)
                        {
                            <div class="ticket_commission_table_container">
                                <table class="sales_commission_table">
                                    <thead>
                                        <tr>
                                            <th>
                                                Technician
                                            </th>
                                            @if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.CommissionAdjustment))
                                            {
                                                <th>
                                                    Adjustment
                                                </th>
                                            }

                                            <th>
                                                Total Commission
                                            </th>
                                            <th>
                                                Point
                                            </th>
                                            @{
                                                if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.CommissionAdjustment))
                                                {
                                                    <th>
                                                        Point Adjustment
                                                    </th>
                                                }
                                            }
                                            <th>
                                                Point Differrence
                                            </th>
                                            @if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.CommissionDelete))
                                            {
                                                <th>
                                                    Action
                                                </th>
                                            }
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var item in Model.AddMemberCommissionList)
                                        {
                                            <tr>
                                                <td>@item.Technician</td>
                                                @{
                                                    if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.CommissionAdjustment))
                                                    {
                                                        <td>
                                                            @{
                                                                if (item.Adjustment > 0)
                                                                {
                                                                    <input type="number" class="form-control adjustment_additional_comission" value="@string.Format("{0:#,##0.00}", item.Adjustment)" data-id="@item.AddMemberCommissionId" data-val="@item.Id">
                                                                }
                                                                else if (item.Adjustment < 0)
                                                                {
                                                                    <input type="number" class="form-control adjustment_additional_comission" value="@string.Format("{0:#,##0.00}", item.Adjustment)" data-id="@item.AddMemberCommissionId" data-val="@item.Id">
                                                                }
                                                                else
                                                                {
                                                                    <input type="number" class="form-control adjustment_additional_comission" value="0.00" data-id="@item.AddMemberCommissionId" data-val="@item.Id">
                                                                }
                                                            }
                                                        </td>
                                                    }

                                                }
                                                <td>
                                                    <span class="additional_total_comission_prev_@item.Id">@Currency@LabelHelper.FormatAmount(item.Commission)</span>
                                                    <span class="additional_total_comission_@item.Id"></span>
                                                </td>
                                                <td>
                                                    <span class="additional_total_point_prev_@item.Id">@LabelHelper.FormatAmount(item.OriginalPoint)</span>
                                                    <span class="additional_total_point_@item.Id"></span>
                                                </td>
                                                <td>
                                                    <span class="mainadjustablepoint_additional_@item.Id">@LabelHelper.FormatAmount(item.AdjustablePoint)</span>
                                                </td>
                                                @{
                                                    if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.CommissionAdjustment))
                                                    {
                                                        <td>
                                                            <input type="number" class="form-control adjustmentpoint_additional_comission" value="0.00" data-id="@item.AddMemberCommissionId" data-val="@item.Id">
                                                        </td>
                                                    }
                                                }
                                                @if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.CommissionDelete))
                                                {
                                                    <td>
                                                        <a data-toggle="tooltip" title="Delete" onclick="DeleteCommission('AddMemberCommission',@item.Id)"><i class="fa fa-trash-o"></i></a>
                                                    </td>
                                                }
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                        }
                    </div>
                }
                @if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.FinRepCommission) && Model.Customer.CustomerExtended.FinanceRep != Guid.Empty)
                {

                    <div class="ticket_bottom_block_inner">
                        <div class="ticket_table_header">
                            Finance Rep Pay
                            @if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.FinRepCommission))
                            {
                                <button class="btn" onclick="AddFinRepCommission()" title="Add Fin Rep Commission"><i class="fa fa-plus"></i></button>
                            }
                        </div>
                        @if (Model.FinRepCommissionList != null && Model.FinRepCommissionList.Count > 0)
                        {
                            <div class="ticket_commission_table_container">
                                <table class="sales_commission_table">
                                    <thead>
                                        <tr>
                                            <th>
                                                Finance Rep
                                            </th>
                                            @if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.CommissionAdjustment))
                                            {
                                                <th>
                                                    Adjustment
                                                </th>
                                            }
                                            <th>
                                                Total Commission
                                            </th>
                                            @if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.CommissionDelete))
                                            {
                                                <th>
                                                    Action
                                                </th>
                                            }
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var item in Model.FinRepCommissionList)
                                        {
                                            <tr>
                                                <td>@item.FinanceRep</td>
                                                @{
                                                    if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.CommissionAdjustment))
                                                    {
                                                        <td>
                                                            @{
                                                                if (item.Adjustment > 0)
                                                                {
                                                                    <input type="number" class="form-control adjustment_fin_rep" value="@string.Format("{0:#,##0.00}", item.Adjustment)" data-id="@item.FinRepCommissionId" data-val="@item.Id">
                                                                }
                                                                else if (item.Adjustment < 0)
                                                                {
                                                                    <input type="number" class="form-control adjustment_fin_rep" value="@string.Format("{0:#,##0.00}", item.Adjustment)" data-id="@item.FinRepCommissionId" data-val="@item.Id">
                                                                }
                                                                else
                                                                {
                                                                    <input type="number" class="form-control adjustment_fin_rep" value="0.00" data-id="@item.FinRepCommissionId" data-val="@item.Id">
                                                                }
                                                            }
                                                        </td>
                                                    }

                                                }
                                                <td>
                                                    <span class="fin_rep_comission_prev_@item.Id">@Currency@LabelHelper.FormatAmount(item.Commission)</span>
                                                    <span class="finrep_total_comission_@item.Id"></span>
                                                </td>
                                                @if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.CommissionDelete))
                                                {
                                                    <td>
                                                        <a data-toggle="tooltip" title="Delete" onclick="DeleteCommission('FinRepCommission',@item.Id)"><i class="fa fa-trash-o"></i></a>
                                                    </td>
                                                }
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                        }
                    </div>
                }
                @if (Model.Ticket.TicketType == "Service" && (Model.ServiceCallCommissionList != null && Model.ServiceCallCommissionList.Count > 0 || PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.AddServiceCallCommission)))
                {

                    <div class="ticket_bottom_block_inner">
                        <div class="ticket_table_header">
                            Service Call Commission
                            @if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.AddServiceCallCommission))
                            {
                                <button class="btn" onclick="AddServiceCallCommission()" title="Add Service Call Commission"><i class="fa fa-plus"></i></button>
                            }
                        </div>
                        @if (Model.ServiceCallCommissionList != null && Model.ServiceCallCommissionList.Count > 0)
                        {
                            <div class="ticket_commission_table_container">
                                <table class="sales_commission_table">
                                    <thead>
                                        <tr>
                                            <th>
                                                Technician
                                            </th>
                                            @if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.CommissionAdjustment))
                                            {
                                                <th>
                                                    Adjustment
                                                </th>
                                            }
                                            <th>
                                                Total Commission
                                            </th>
                                            @if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.CommissionDelete))
                                            {
                                                <th>
                                                    Action
                                                </th>
                                            }
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var item in Model.ServiceCallCommissionList)
                                        {
                                            <tr>
                                                <td>@item.Technician</td>
                                                @{
                                                    if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.CommissionAdjustment))
                                                    {
                                                        <td>
                                                            @{
                                                                if (item.Adjustment > 0)
                                                                {
                                                                    <input type="number" class="form-control adjustment_additional_comission_service" value="@string.Format("{0:#,##0.00}", item.Adjustment)" data-id="@item.ServiceCallCommissionId" data-val="@item.Id">
                                                                }
                                                                else if (item.Adjustment < 0)
                                                                {
                                                                    <input type="number" class="form-control adjustment_additional_comission_service" value="@string.Format("{0:#,##0.00}", item.Adjustment)" data-id="@item.ServiceCallCommissionId" data-val="@item.Id">
                                                                }
                                                                else
                                                                {
                                                                    <input type="number" class="form-control adjustment_additional_comission_service" value="0.00" data-id="@item.ServiceCallCommissionId" data-val="@item.Id">
                                                                }
                                                            }
                                                        </td>
                                                    }

                                                }
                                                <td>
                                                    <span class="additional_total_comission_prev_service_@item.Id">@Currency@LabelHelper.FormatAmount(item.Commission)</span>
                                                    <span class="additional_total_comission_service_@item.Id"></span>
                                                </td>
                                                @if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.CommissionDelete))
                                                {
                                                    <td>
                                                        <a data-toggle="tooltip" title="Delete" onclick="DeleteCommission('ServiceCallCommission',@item.Id)"><i class="fa fa-trash-o"></i></a>
                                                    </td>
                                                }
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                        }
                    </div>

                }
                @if (Model.FollowUpCommissionList != null && Model.FollowUpCommissionList.Count > 0)
                {

                    <div class="ticket_bottom_block_inner">
                        <div class="ticket_table_header">
                            Follow Up Commission
                            @if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.AddFollowUpCommission))
                            {
                                <button class="btn" onclick="AddFollowUpCommission()" title="Add Follow Up Commission"><i class="fa fa-plus"></i></button>
                            }
                        </div>


                        <div class="ticket_commission_table_container">
                            <table class="sales_commission_table">
                                <thead>
                                    <tr>
                                        <th>
                                            Technician
                                        </th>
                                        @if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.CommissionAdjustment))
                                        {
                                            <th>
                                                Adjustment
                                            </th>
                                        }

                                        <th>
                                            Total Commission
                                        </th>
                                        @if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.CommissionDelete))
                                        {
                                            <th>
                                                Action
                                            </th>
                                        }
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model.FollowUpCommissionList)
                                    {
                                        <tr>
                                            <td>@item.Technician</td>
                                            @{
                                                if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.CommissionAdjustment))
                                                {
                                                    <td>
                                                        @{
                                                            if (item.Adjustment > 0)
                                                            {
                                                                <input type="number" class="form-control adjustment_additional_comission_followup" value="@string.Format("{0:#,##0.00}", item.Adjustment)" data-id="@item.FollowUpCommissionId" data-val="@item.Id">
                                                            }
                                                            else if (item.Adjustment < 0)
                                                            {
                                                                <input type="number" class="form-control adjustment_additional_comission_followup" value="@string.Format("{0:#,##0.00}", item.Adjustment)" data-id="@item.FollowUpCommissionId" data-val="@item.Id">
                                                            }
                                                            else
                                                            {
                                                                <input type="number" class="form-control adjustment_additional_comission_followup" value="0.00" data-id="@item.FollowUpCommissionId" data-val="@item.Id">
                                                            }
                                                        }
                                                    </td>
                                                }

                                            }
                                            <td>
                                                <span class="additional_total_comission_prev_followup_@item.Id">@Currency@LabelHelper.FormatAmount(item.Commission)</span>
                                                <span class="additional_total_comission_followup_@item.Id"></span>
                                            </td>
                                            @if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.CommissionDelete))
                                            {
                                                <td>
                                                    <a data-toggle="tooltip" title="Delete" onclick="DeleteCommission('FollowUpCommission',@item.Id)"><i class="fa fa-trash-o"></i></a>
                                                </td>
                                            }
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                }
                @if (Model.RescheduleCommissionList != null && Model.RescheduleCommissionList.Count > 0)
                {
                    <div class="ticket_bottom_block_inner">

                        <div class="ticket_table_header">
                            Reschedule Commission
                            @if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.AddRescheduleCommission))
                            {
                                <button class="btn" onclick="AddRescheduleCommission()" title="Add Reschedule Commission"><i class="fa fa-plus"></i></button>
                            }
                        </div>
                        <div class="ticket_commission_table_container">
                            <table class="sales_commission_table">
                                <thead>
                                    <tr>
                                        <th>
                                            Technician
                                        </th>
                                        @if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.CommissionAdjustment))
                                        {
                                            <th>
                                                Adjustment
                                            </th>
                                        }

                                        <th>
                                            Total Commission
                                        </th>
                                        @if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.CommissionDelete))
                                        {
                                            <th>
                                                Action
                                            </th>
                                        }
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model.RescheduleCommissionList)
                                    {
                                        <tr>
                                            <td>@item.Technician</td>
                                            @{
                                                if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.CommissionAdjustment))
                                                {
                                                    <td>
                                                        @{
                                                            if (item.Adjustment > 0)
                                                            {
                                                                <input type="number" class="form-control adjustment_additional_comission_reschedule" value="@string.Format("{0:#,##0.00}", item.Adjustment)" data-id="@item.RescheduleCommissionId" data-val="@item.Id">
                                                            }
                                                            else if (item.Adjustment < 0)
                                                            {
                                                                <input type="number" class="form-control adjustment_additional_comission_reschedule" value="@string.Format("{0:#,##0.00}", item.Adjustment)" data-id="@item.RescheduleCommissionId" data-val="@item.Id">
                                                            }
                                                            else
                                                            {
                                                                <input type="number" class="form-control adjustment_additional_comission_reschedule" value="0.00" data-id="@item.RescheduleCommissionId" data-val="@item.Id">
                                                            }
                                                        }
                                                    </td>
                                                }

                                            }
                                            <td>
                                                <span class="additional_total_comission_prev_reschedule_@item.Id">@Currency@LabelHelper.FormatAmount(item.Commission)</span>
                                                <span class="additional_total_comission_reschedule_@item.Id"></span>
                                            </td>
                                            @if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.CommissionDelete))
                                            {
                                                <td>
                                                    <a data-toggle="tooltip" title="Delete" onclick="DeleteCommission('RescheduleCommission',@item.Id)"><i class="fa fa-trash-o"></i></a>
                                                </td>
                                            }
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                }
            </div>
        }
        <div class="width-100p">
            @if (Model.TicketBookingExtraItem != null || Model.TicketBookingDetails != null)
            {
                <div class="booking_items">

                    @{
                        Html.RenderPartial("_TicketBooking", Model);
                    }

                </div>
            }
        </div>
    </div>
</div>
<div class="add_ticktet_btn_footer">
    <div>
        <button class="float-right btn green_button" id="CreateTicket" data-id="@Model.Ticket.Id"><i class="fa fa-floppy-o" aria-hidden="true"></i> @(Model.Ticket.Status == TickStat.Init ? Localize.T("Create Ticket") : Localize.T("Save Ticket"))</button>
        @if (Model.Ticket.Status != TickStat.Init)
        {
            if (PermissionChekcer.IsPermitted(Permissions.CustomerPermissions.TicketDeletePermission))
            {
                <button class="btn btn-danger" id="btn_del_ticket" data-id="@Model.Ticket.Id"><i class="fa fa-trash"></i> @Localize.T("Delete")</button>
            }

            if (Request.Browser.IsMobileDevice)
            {
                <button class="float-right btn PrintTicket green_button" id="PrintTicketForPhone" title="Print  @Localize.T("Ticket")"><i class="fa fa-print"></i> </button>
                @*<a class="TicketPrint" id="TicketPrint" href="@(AppConfig.DomainSitePath)/Ticket/TicketPreviewPopup/?Id=@Model.Ticket.Id"></a>*@
            }
            else
            {
                <button class="float-right btn PrintTicket green_button" id="PrintTicket" title="Print @Localize.T("Ticket")"><i class="fa fa-print"></i></button>
                <a class="TicketPrint" id="TicketPrint" href="@(AppConfig.DomainSitePath)/Ticket/TicketPreviewPopup/?Id=@Model.Ticket.Id"></a>
            }
            if (PermissionChekcer.IsPermitted(Permissions.CustomerTicketPermission.SendNotificationButton))
            {
                <button class="float-right btn SendNotification green_button" id="SendNotification" title="Send Notification" href="@(AppConfig.DomainSitePath)/Ticket/NotificationSendPopUp?TicketId=@Model.Ticket.Id"><i class="fa fa-bullhorn"></i> </button>
            }
        }
    </div>
</div>
<button type="button" id="OpenTextAndAmmountModal" style="display:none;" class="btn btn-info btn-lg" data-toggle="modal" data-target="#ModalOpenTextAndAmmount">Open Modal</button>
<div class="modal fade" id="ModalOpenTextAndAmmount" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header message_header_container">
                <button type="button" class="closenew" data-dismiss="modal" onclick="DefaultSuccessfunc(true);">&times;</button>
                <div class="message_header_border"></div>
                <span class="modal-title message_header_title">Enter Invoice description and amount</span>
            </div>
            <div class="inv_desc_amount_content">
                <div>
                    <label>Amount</label>
                    <input type="number" placeholder="$XXXX.XX" id="InvAmmount" class="form-control" />
                </div>
                <div>
                    <label>Description</label>
                    <textarea placeholder="Enter invoice description" rows="4" cols="50" id="InvDes"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn" id="__ConfirmationMessageModal_" onclick="DefaultSuccessfunc(true);" data-dismiss="modal">@Localize.T("Create Invoice")</button>
            </div>
        </div>
    </div>
</div>
<div style="display:none">
    <a href="" class="MapManufacturerMagnific">@Localize.T("Address in Map")</a>
    <a href="" class="MapManufacturerMagnificPrevious">@Localize.T("Address in Map")</a>
    <a href="" class="MapManufacturerMagnific_signature">@Localize.T("Address in Map")</a>
    <a href="" class="ReScheduleTicketMagnific">@Localize.T("Reschedule Ticket")</a>
    <a href="" class="MemberAppointmentMagnific">@Localize.T("Member Appointment")</a>
    <a href="" class="BadInventoryAndUserAssignMagnific">@Localize.T("Bad Inventory and User Assign")</a>
    <a href="" class="CodeSafetyDocumentMagnific">@Localize.T("Code Safety Document")</a>
    <a href="" class="EquipmentConditionMagnific">@Localize.T("Equipment Condition")</a>
    <a href="" class="RUgTicketAgreementMagnific">@Localize.T("Ticket Agreement")</a>
    <a href="" class="FirstPageAgreementDocument">@Localize.T("First Page")</a>
    <a href="" class="CommercialAgreementDocument">@Localize.T("Commercial Agreement")</a>
    <input type="hidden" value="@Model.Customer.Street" id="street" />
    <input type="hidden" value="@Model.Customer.City" id="city" />
    <input type="hidden" value="@Model.Customer.State" id="state" />
    <input type="hidden" value="@Model.Customer.ZipCode" id="zipcode" />
    @*/SmartLeads/GetSmartLeadsForPopUp?LeadId*@
    <a class="LoadAgreementPopUp" style="display:none;" id="InstallationAgreement" href="@(AppConfig.DomainSitePath)/SmartLeads/GetSmartLeadsForPopUp?LeadId=@Model.Customer.Id">@Localize.T("Save & Done ")</a>
    <a class="LoadCustomerAddendumPopUp" style="display:none;" id="InstallCustomerAddendum" href="@(AppConfig.DomainSitePath)/Ticket/GetCustomerAddendumPopUp?CustomerId='@Model.Customer.CustomerId'&TicketId='@Model.Ticket.TicketId'">@Localize.T("Save & Done ")</a>
    <a class="LoadWorkToBePerformedAddendumPopUp" style="display:none;" id="WorkToBePerformedAddendum" href="@(AppConfig.DomainSitePath)/Ticket/GetWorkToBePerformedAddendumPopUp?CustomerId='@Model.Customer.CustomerId'&TicketId='@Model.Ticket.TicketId'">@Localize.T("Save & Done")</a>
    <a href="" class="TicketNotificationMagnific">@Localize.T("Ticket Notification")</a>
    <a href="" class="TicketSurveyMagnific">@Localize.T("Ticket Survey")</a>
</div>
<script src="~/Content/Tiny/tiny.js"></script>
